# 提交表单完整解决方案

## ✅ 问题已解决！

测试用户已经创建成功！现在您可以登录并提交表单了。

## 📋 测试账号信息

### 教研室端账号（用于提交自评表）
- **用户名**: `test_teaching_office`
- **密码**: `password123`
- **角色**: 教研室端

### 考评小组账号（用于查看提交的表单）
- **用户名**: `test_eval_team`
- **密码**: `password123`
- **角色**: 考评小组

## 🚀 完整操作流程

### 第一步：登录教研室端账号

1. 打开浏览器，访问登录页面：
   ```
   http://localhost:3000/login
   ```

2. 输入教研室端账号：
   - 用户名：`test_teaching_office`
   - 密码：`password123`

3. 点击"登录"按钮

### 第二步：填写并提交自评表

1. 登录成功后，访问自评表页面：
   ```
   http://localhost:3000/self-evaluation
   ```

2. 填写表单的所有必填项：
   - **一、常规教学工作**（8个指标，每项需要填写内容和自评分）
   - **二、特色与亮点项目**（可选，可以添加项目）
   - **三、负面清单**（可选，默认为0）

3. 点击页面底部的"提交表单"按钮

4. 在弹出的确认对话框中，点击"确定"

5. 等待提示信息：
   - 首先显示："正在提交自评表，请稍候..."
   - 然后显示："提交成功！数据已上传到考评小组端"

6. 页面会自动跳转到教研室端主页

### 第三步：验证提交结果

1. 退出当前账号（点击右上角退出）

2. 使用考评小组账号登录：
   - 用户名：`test_eval_team`
   - 密码：`password123`

3. 访问手动评分页面：
   ```
   http://localhost:3000/manual-scoring
   ```

4. 您应该能看到刚才提交的自评表出现在列表中

## 🔍 提交流程说明

### 用户看到的流程
```
填写表单 → 点击"提交表单" → 确认提交 → 
看到"正在提交..." → 看到"提交成功！" → 自动跳转
```

### 系统后台处理（自动完成）
```
1. 保存表单数据（status: draft）
2. 提交并锁定（status: locked）
3. 触发AI评分（status: ai_scored）
4. 数据出现在考评小组端列表
```

## ❓ 常见问题

### Q1: 为什么必须登录？

**答**: 系统需要知道：
- 是哪个教研室提交的数据
- 谁提交的（用于审计）
- 确保数据安全性

### Q2: 如果忘记密码怎么办？

**答**: 测试账号的密码都是 `password123`。如果需要重置，可以在MySQL中重新运行 `setup_test_users.sql` 文件。

### Q3: 提交后能修改吗？

**答**: 不能。提交后表单会被锁定（status: locked），无法修改。这是为了保证数据的完整性和可追溯性。

### Q4: 如果提交失败怎么办？

**答**: 检查以下几点：
1. 确保已经登录
2. 确保所有必填项都已填写
3. 检查浏览器控制台（F12）查看错误信息
4. 检查后端服务是否正常运行

### Q5: 在手动评分页面看不到提交的表单？

**答**: 确认以下几点：
1. 使用的是考评小组或考评办公室账号（不是教研室账号）
2. 表单状态是 `locked` 或 `ai_scored`
3. 刷新页面重新加载数据

## 🔧 验证方法

### 方法1: 查看浏览器控制台

1. 按 F12 打开开发者工具
2. 切换到 "Network" 标签
3. 点击提交表单
4. 查看API请求：
   - `POST /api/teaching-office/self-evaluation` - 应该返回 201
   - `POST /api/teaching-office/self-evaluation/{id}/submit` - 应该返回 200
   - `POST /api/teaching-office/trigger-ai-scoring` - 应该返回 200

### 方法2: 查看数据库

在MySQL中执行：

```sql
-- 查看最新提交的自评表
SELECT id, teaching_office_id, evaluation_year, status, submitted_at 
FROM self_evaluations 
ORDER BY created_at DESC 
LIMIT 1;

-- 应该看到状态为 'locked' 或 'ai_scored'
```

### 方法3: 查看后端日志

查看后端进程输出，应该看到类似的日志：

```
INFO: POST /api/teaching-office/self-evaluation - 201 Created
INFO: POST /api/teaching-office/self-evaluation/{id}/submit - 200 OK
INFO: POST /api/teaching-office/trigger-ai-scoring - 200 OK
```

## 📊 数据状态流转

```
draft (草稿)
  ↓
locked (已锁定，已提交)
  ↓
ai_scored (AI评分完成)
  ↓
manually_scored (手动评分完成)
  ↓
finalized (最终得分确定)
  ↓
published (已发布)
```

## 🎯 快速测试步骤

1. **登录**: http://localhost:3000/login
   - 用户名: `test_teaching_office`
   - 密码: `password123`

2. **填写表单**: http://localhost:3000/self-evaluation
   - 填写所有必填项
   - 点击"提交表单"

3. **验证结果**: 
   - 退出登录
   - 用 `test_eval_team` 账号登录
   - 访问 http://localhost:3000/manual-scoring
   - 查看提交的表单

## ✨ 总结

现在您可以：
- ✅ 使用测试账号登录
- ✅ 填写并提交自评表
- ✅ 在考评小组端查看提交的表单
- ✅ 完整测试整个提交流程

如果遇到任何问题，请查看：
- 浏览器控制台的错误信息
- 后端日志输出
- MySQL数据库中的数据

祝您测试顺利！🎉
