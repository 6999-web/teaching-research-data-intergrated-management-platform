# æ•™ç ”å®¤æ•°æ®ç®¡ç†å¹³å° - ç«¯å£å’Œæ•°æ®åº“é…ç½®è¯´æ˜

## ğŸ“Š ç«¯å£é…ç½®æ€»è§ˆ

### å‰ç«¯ç«¯å£
- **å¼€å‘ç¯å¢ƒ**: `3000`
  - è®¿é—®åœ°å€: http://localhost:3000
  - å¯åŠ¨å‘½ä»¤: `cd frontend && npm run dev`

- **ç”Ÿäº§ç¯å¢ƒ**: `80` (é€šè¿‡Nginxä»£ç†)
  - è®¿é—®åœ°å€: http://101.33.211.98
  - é™æ€æ–‡ä»¶ç›®å½•: `frontend/dist`

### åç«¯ç«¯å£
- **å¼€å‘ç¯å¢ƒ**: `8000`
  - è®¿é—®åœ°å€: http://localhost:8000
  - APIæ–‡æ¡£: http://localhost:8000/docs
  - å¥åº·æ£€æŸ¥: http://localhost:8000/api/health
  - å¯åŠ¨å‘½ä»¤: `cd backend && python -m uvicorn app.main:app --reload --port 8000`

- **ç”Ÿäº§ç¯å¢ƒ**: `8000`
  - è®¿é—®åœ°å€: http://101.33.211.98:8000
  - æˆ–é€šè¿‡Nginxä»£ç†: http://101.33.211.98/api

### æ•°æ®åº“ç«¯å£
- **PostgreSQL**: `5432` (æ¨èç”¨äºç”Ÿäº§ç¯å¢ƒ)
- **MySQL**: `3306` (å¤‡é€‰æ–¹æ¡ˆ)
- **SQLite**: æ— ç«¯å£ (ä»…ç”¨äºå¼€å‘æµ‹è¯•)

### å…¶ä»–ç«¯å£
- **å®å¡”é¢æ¿**: `8888`
- **MinIOå¯¹è±¡å­˜å‚¨**: `9000` (å¦‚æœä½¿ç”¨)

---

## ğŸ—„ï¸ æ•°æ®åº“é…ç½®è¯¦è§£

### å½“å‰å¼€å‘ç¯å¢ƒé…ç½®

**æ•°æ®åº“ç±»å‹**: SQLite
```env
USE_SQLITE=true
```

**æ•°æ®åº“æ–‡ä»¶ä½ç½®**:
- `backend/test.db`
- `test.db` (é¡¹ç›®æ ¹ç›®å½•)
- `test_auth.db` (è®¤è¯æµ‹è¯•æ•°æ®åº“)

**ä¼˜ç‚¹**:
- âœ… æ— éœ€å®‰è£…æ•°æ®åº“æœåŠ¡
- âœ… é…ç½®ç®€å•
- âœ… é€‚åˆå¼€å‘æµ‹è¯•

**ç¼ºç‚¹**:
- âŒ ä¸æ”¯æŒå¹¶å‘å†™å…¥
- âŒ æ€§èƒ½è¾ƒä½
- âŒ ä¸é€‚åˆç”Ÿäº§ç¯å¢ƒ

### ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®

#### æ–¹æ¡ˆ1: PostgreSQL (æ¨è)

**é…ç½®ä¿¡æ¯**:
```env
USE_SQLITE=false
POSTGRES_SERVER=localhost
POSTGRES_USER=teaching_office_user
POSTGRES_PASSWORD=ä½ çš„å®‰å…¨å¯†ç 
POSTGRES_DB=teaching_office_evaluation
POSTGRES_PORT=5432
```

**è¿æ¥å­—ç¬¦ä¸²**:
```
postgresql://teaching_office_user:å¯†ç @localhost:5432/teaching_office_evaluation
```

**ä¼˜ç‚¹**:
- âœ… æ€§èƒ½ä¼˜ç§€
- âœ… æ”¯æŒé«˜å¹¶å‘
- âœ… åŠŸèƒ½å¼ºå¤§
- âœ… æ•°æ®å®Œæ•´æ€§å¥½

**å®‰è£…å‘½ä»¤**:
```bash
# Ubuntu/Debian
sudo apt install postgresql postgresql-contrib

# CentOS
sudo yum install postgresql-server postgresql-contrib
```

#### æ–¹æ¡ˆ2: MySQL (å¤‡é€‰)

**é…ç½®ä¿¡æ¯**:
```env
USE_SQLITE=false
DATABASE_URL=mysql+pymysql://teaching_office_user:å¯†ç @localhost:3306/teaching_office_evaluation
```

**ä¼˜ç‚¹**:
- âœ… å¹¿æ³›ä½¿ç”¨
- âœ… å®å¡”é¢æ¿æ”¯æŒå¥½
- âœ… ç®¡ç†å·¥å…·ä¸°å¯Œ

**å®‰è£…å‘½ä»¤**:
```bash
# Ubuntu/Debian
sudo apt install mysql-server

# CentOS
sudo yum install mysql-server
```

---

## ğŸ”„ æ•°æ®åº“è¿ç§»åˆ°å®å¡”çš„ä¸‰ç§æ–¹æ³•

### æ–¹æ³•1: å…¨æ–°åˆå§‹åŒ–ï¼ˆæœ€ç®€å•ï¼Œæ¨èï¼‰

é€‚ç”¨äºï¼šå¼€å‘ç¯å¢ƒæ•°æ®ä¸é‡è¦ï¼Œå¯ä»¥é‡æ–°å¼€å§‹

**æ­¥éª¤**:

1. **åœ¨å®å¡”é¢æ¿åˆ›å»ºæ•°æ®åº“**
   - ç™»å½•å®å¡”é¢æ¿: http://101.33.211.98:8888
   - ç‚¹å‡» **æ•°æ®åº“** â†’ **PostgreSQL** (æˆ–MySQL)
   - ç‚¹å‡» **æ·»åŠ æ•°æ®åº“**
   - æ•°æ®åº“å: `teaching_office_evaluation`
   - ç”¨æˆ·å: `teaching_office_user`
   - å¯†ç : è®¾ç½®å¼ºå¯†ç å¹¶è®°å½•

2. **é…ç½®åç«¯ç¯å¢ƒå˜é‡**
   ```bash
   cd /www/wwwroot/teaching-office-platform/backend
   nano .env
   ```
   
   ä¿®æ”¹ä¸ºï¼š
   ```env
   USE_SQLITE=false
   POSTGRES_SERVER=localhost
   POSTGRES_USER=teaching_office_user
   POSTGRES_PASSWORD=ä½ è®¾ç½®çš„å¯†ç 
   POSTGRES_DB=teaching_office_evaluation
   POSTGRES_PORT=5432
   ```

3. **è¿è¡Œæ•°æ®åº“è¿ç§»**
   ```bash
   cd /www/wwwroot/teaching-office-platform/backend
   alembic upgrade head
   ```

4. **åˆå§‹åŒ–æ•°æ®ï¼ˆå¯é€‰ï¼‰**
   ```bash
   python3 -c "from app.db.init_db import init_db; init_db()"
   ```

### æ–¹æ³•2: ä»SQLiteå¯¼å‡ºæ•°æ®

é€‚ç”¨äºï¼šéœ€è¦ä¿ç•™å¼€å‘ç¯å¢ƒçš„æµ‹è¯•æ•°æ®

**æ­¥éª¤**:

1. **åœ¨æœ¬åœ°å¯¼å‡ºSQLiteæ•°æ®**
   ```bash
   cd backend
   sqlite3 test.db .dump > data.sql
   ```

2. **ä¸Šä¼ åˆ°æœåŠ¡å™¨**
   ```bash
   scp data.sql root@101.33.211.98:/tmp/
   ```

3. **åœ¨å®å¡”åˆ›å»ºæ•°æ®åº“**ï¼ˆåŒæ–¹æ³•1ï¼‰

4. **è½¬æ¢å¹¶å¯¼å…¥æ•°æ®**
   ```bash
   ssh root@101.33.211.98
   
   # å®‰è£…è½¬æ¢å·¥å…·
   pip3 install sqlite3-to-postgresql
   
   # ä¸Šä¼ SQLiteæ–‡ä»¶
   scp backend/test.db root@101.33.211.98:/tmp/
   
   # è½¬æ¢å¹¶å¯¼å…¥
   sqlite3-to-postgresql \
     --sqlite-file /tmp/test.db \
     --postgres-dsn "postgresql://teaching_office_user:å¯†ç @localhost:5432/teaching_office_evaluation"
   ```

### æ–¹æ³•3: ä½¿ç”¨å®å¡”æ•°æ®åº“ç®¡ç†å·¥å…·

é€‚ç”¨äºï¼šæœ‰ç°æœ‰æ•°æ®åº“éœ€è¦å¯¼å…¥

**æ­¥éª¤**:

1. **å¯¼å‡ºç°æœ‰æ•°æ®**
   - å¦‚æœæ˜¯PostgreSQL: ä½¿ç”¨ `pg_dump`
   - å¦‚æœæ˜¯MySQL: ä½¿ç”¨ `mysqldump`
   - å¦‚æœæ˜¯SQLite: ä½¿ç”¨ `.dump`

2. **åœ¨å®å¡”é¢æ¿å¯¼å…¥**
   - ç™»å½•å®å¡”é¢æ¿
   - ç‚¹å‡» **æ•°æ®åº“** â†’ é€‰æ‹©æ•°æ®åº“
   - ç‚¹å‡» **ç®¡ç†** â†’ **å¯¼å…¥**
   - ä¸Šä¼ SQLæ–‡ä»¶
   - ç‚¹å‡» **å¯¼å…¥**

---

## ğŸ”§ é…ç½®æ–‡ä»¶ä½ç½®

### åç«¯é…ç½®æ–‡ä»¶
- **ä¸»é…ç½®**: `backend/.env`
- **ç”Ÿäº§é…ç½®æ¨¡æ¿**: `backend/.env.production`
- **ç¤ºä¾‹é…ç½®**: `backend/.env.example`
- **æ•°æ®åº“é…ç½®**: `backend/app/core/config.py`

### å‰ç«¯é…ç½®æ–‡ä»¶
- **å¼€å‘é…ç½®**: `frontend/.env.development`
- **ç”Ÿäº§é…ç½®**: `frontend/.env.production`
- **Viteé…ç½®**: `frontend/vite.config.ts`
- **APIå®¢æˆ·ç«¯**: `frontend/src/api/client.ts`

### æ•°æ®åº“è¿ç§»æ–‡ä»¶
- **è¿ç§»é…ç½®**: `backend/alembic.ini`
- **è¿ç§»è„šæœ¬**: `backend/alembic/versions/`

---

## ğŸ“ å®Œæ•´çš„ç¯å¢ƒå˜é‡é…ç½®ç¤ºä¾‹

### å¼€å‘ç¯å¢ƒ (backend/.env)

```env
# é¡¹ç›®é…ç½®
PROJECT_NAME=æ•™ç ”å®¤å·¥ä½œè€ƒè¯„ç³»ç»Ÿ
API_V1_STR=/api

# æ•°æ®åº“é…ç½® - SQLite (å¼€å‘)
USE_SQLITE=true

# å®‰å…¨é…ç½®
SECRET_KEY=dev-secret-key-change-in-production
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=10080

# CORSé…ç½®
BACKEND_CORS_ORIGINS=["http://localhost:3000","http://127.0.0.1:3000"]

# DeepSeek API (å¯é€‰)
DEEPSEEK_API_KEY=
DEEPSEEK_API_URL=https://api.deepseek.com/v1/chat/completions

# MinIOé…ç½® (å¯é€‰)
MINIO_ENDPOINT=localhost:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_BUCKET=teaching-office-attachments
MINIO_SECURE=false
```

### ç”Ÿäº§ç¯å¢ƒ (backend/.env)

```env
# é¡¹ç›®é…ç½®
PROJECT_NAME=æ•™ç ”å®¤å·¥ä½œè€ƒè¯„ç³»ç»Ÿ
API_V1_STR=/api

# æ•°æ®åº“é…ç½® - PostgreSQL (ç”Ÿäº§)
USE_SQLITE=false
POSTGRES_SERVER=localhost
POSTGRES_USER=teaching_office_user
POSTGRES_PASSWORD=ä½ çš„è¶…å¼ºå¯†ç 123!@#
POSTGRES_DB=teaching_office_evaluation
POSTGRES_PORT=5432

# å®‰å…¨é…ç½® (ä½¿ç”¨ openssl rand -hex 32 ç”Ÿæˆ)
SECRET_KEY=a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=10080

# CORSé…ç½®
BACKEND_CORS_ORIGINS=["http://101.33.211.98","http://101.33.211.98:3000","http://101.33.211.98:8000","https://yourdomain.com"]

# DeepSeek API
DEEPSEEK_API_KEY=sk-your-actual-api-key-here
DEEPSEEK_API_URL=https://api.deepseek.com/v1/chat/completions

# MinIOé…ç½®
MINIO_ENDPOINT=101.33.211.98:9000
MINIO_ACCESS_KEY=your-minio-access-key
MINIO_SECRET_KEY=your-minio-secret-key
MINIO_BUCKET=teaching-office-attachments
MINIO_SECURE=false
```

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨å‘½ä»¤

### æœ¬åœ°å¼€å‘ç¯å¢ƒ

```bash
# å¯åŠ¨åç«¯ (ç«¯å£8000)
cd backend
$env:USE_SQLITE="true"  # Windows PowerShell
# æˆ– export USE_SQLITE=true  # Linux/Mac
python -m uvicorn app.main:app --reload --port 8000

# å¯åŠ¨å‰ç«¯ (ç«¯å£3000)
cd frontend
npm run dev
```

### ç”Ÿäº§ç¯å¢ƒï¼ˆå®å¡”ï¼‰

```bash
# åç«¯é€šè¿‡Supervisorç®¡ç†ï¼Œåœ¨å®å¡”é¢æ¿æ“ä½œ
# æˆ–ä½¿ç”¨å‘½ä»¤è¡Œï¼š
supervisorctl start teaching-office-backend
supervisorctl status teaching-office-backend

# å‰ç«¯å·²æ„å»ºä¸ºé™æ€æ–‡ä»¶ï¼Œç”±NginxæœåŠ¡
# é‡æ–°æ„å»ºï¼š
cd /www/wwwroot/teaching-office-platform/frontend
npm run build

# é‡è½½Nginx
/etc/init.d/nginx reload
```

---

## ğŸ” éªŒè¯é…ç½®

### æ£€æŸ¥ç«¯å£å ç”¨

```bash
# æ£€æŸ¥8000ç«¯å£ï¼ˆåç«¯ï¼‰
netstat -tlnp | grep 8000
# æˆ–
lsof -i :8000

# æ£€æŸ¥3000ç«¯å£ï¼ˆå‰ç«¯å¼€å‘ï¼‰
netstat -tlnp | grep 3000

# æ£€æŸ¥80ç«¯å£ï¼ˆNginxï¼‰
netstat -tlnp | grep 80

# æ£€æŸ¥5432ç«¯å£ï¼ˆPostgreSQLï¼‰
netstat -tlnp | grep 5432
```

### æµ‹è¯•æ•°æ®åº“è¿æ¥

```bash
# PostgreSQL
psql -U teaching_office_user -d teaching_office_evaluation -h localhost

# MySQL
mysql -u teaching_office_user -p -h localhost teaching_office_evaluation

# SQLite
sqlite3 backend/test.db
```

### æµ‹è¯•APIæ¥å£

```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:8000/api/health
curl http://101.33.211.98:8000/api/health

# APIæ–‡æ¡£
curl http://localhost:8000/docs
curl http://101.33.211.98:8000/docs
```

---

## ğŸ“ å¸¸è§é—®é¢˜

### Q1: ç«¯å£è¢«å ç”¨æ€ä¹ˆåŠï¼Ÿ

```bash
# æŸ¥æ‰¾å ç”¨è¿›ç¨‹
lsof -i :8000

# æ€æ­»è¿›ç¨‹
kill -9 è¿›ç¨‹ID

# æˆ–æ›´æ”¹ç«¯å£
python -m uvicorn app.main:app --port 8001
```

### Q2: æ•°æ®åº“è¿æ¥å¤±è´¥ï¼Ÿ

**æ£€æŸ¥æ¸…å•**:
- [ ] æ•°æ®åº“æœåŠ¡æ˜¯å¦å¯åŠ¨
- [ ] ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®
- [ ] æ•°æ®åº“åæ˜¯å¦å­˜åœ¨
- [ ] ç«¯å£æ˜¯å¦æ­£ç¡®
- [ ] é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ç«¯å£

### Q3: å¦‚ä½•åˆ‡æ¢æ•°æ®åº“ï¼Ÿ

ä¿®æ”¹ `backend/.env` æ–‡ä»¶ï¼š
```env
# ä½¿ç”¨SQLite
USE_SQLITE=true

# ä½¿ç”¨PostgreSQL
USE_SQLITE=false
POSTGRES_SERVER=localhost
# ... å…¶ä»–é…ç½®

# ä½¿ç”¨MySQL
USE_SQLITE=false
DATABASE_URL=mysql+pymysql://user:pass@localhost:3306/dbname
```

ç„¶åé‡å¯åç«¯æœåŠ¡ã€‚

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å®å¡”é¢æ¿éƒ¨ç½²æŒ‡å—](å®å¡”é¢æ¿éƒ¨ç½²æŒ‡å—.md) - è¯¦ç»†çš„å®å¡”éƒ¨ç½²æ­¥éª¤
- [è…¾è®¯äº‘éƒ¨ç½²æŒ‡å—](è…¾è®¯äº‘éƒ¨ç½²æŒ‡å—.md) - ä¼ ç»ŸLinuxéƒ¨ç½²æ–¹æ³•
- [æ•™ç ”å®¤æ•°æ®ç®¡ç†å¹³å°ä»‹ç»æ–‡æ¡£](æ•™ç ”å®¤æ•°æ®ç®¡ç†å¹³å°ä»‹ç»æ–‡æ¡£.md) - ç³»ç»ŸåŠŸèƒ½ä»‹ç»

---

**æœ€åæ›´æ–°**: 2026-02-09  
**ç‰ˆæœ¬**: v1.1.0

---

Â© 2026 æ•™ç ”å®¤æ•°æ®ç®¡ç†å¹³å°. All rights reserved.
