# 教研室工作考评系统 - 系统状态快速参考

**更新时间**: 2026-02-15 16:46:17  
**系统状态**: ✅ 所有功能正常  

---

## 🎯 系统概览

| 项目 | 状态 | 备注 |
|-----|------|------|
| 后端 API | ✅ 运行中 | http://localhost:8000 |
| 前端应用 | ✅ 运行中 | http://localhost:3000 |
| 数据库 | ✅ 连接正常 | MySQL localhost:3306 |
| 文件存储 | ✅ 正常 | MinIO 或本地存储 |
| 权限系统 | ✅ 正常 | JWT + 角色检查 |

---

## 📊 功能测试结果

### 教研室端 (director1)
```
✅ 登录                    成功
✅ 创建考评表              成功
✅ 上传附件                成功
✅ 提交考评表              成功
```

### 考评小组端 (evaluator1)
```
✅ 登录                    成功
✅ 加载考评表              成功
✅ 加载附件                成功
✅ 手动评分                成功
```

---

## 🔐 权限检查状态

### 角色权限
```
teaching_office      ✅ 可创建和提交考评表
evaluation_team      ✅ 可进行评分
evaluation_office    ✅ 可进行评分和确定最终分数
president_office     ✅ 可查看数据
```

### API 权限
```
POST /self-evaluation              ✅ require_teaching_office
GET  /self-evaluation/{id}         ✅ get_current_user
POST /attachments                  ✅ require_teaching_office
GET  /attachments/{id}             ✅ get_current_user
POST /manual-score                 ✅ require_management_roles
```

---

## 🔧 最近修复

### 修复 1: 权限检查 (2026-02-15)
- ✅ 添加 RoleChecker 类
- ✅ 实现角色权限检查
- ✅ 添加详细日志记录

### 修复 2: API 路径 (2026-02-15)
- ✅ 更新前端 API 调用
- ✅ 统一 API 路径格式
- ✅ 验证路径一致性

### 修复 3: 测试脚本 (2026-02-15)
- ✅ 修复编码问题
- ✅ 修复格式问题
- ✅ 添加超时处理

---

## 📝 测试账号

### 教研室账号
```
用户名: director1
密码: password123
角色: teaching_office
```

### 考评小组账号
```
用户名: evaluator1
密码: password123
角色: evaluation_team
```

---

## 🚀 快速启动

### 启动后端
```bash
cd backend
python -m uvicorn app.main:app --reload
```

### 启动前端
```bash
cd frontend
npm run dev
```

### 运行测试
```bash
python 自动化测试脚本.py
```

---

## 📋 常见问题排查

### 问题: 403 Forbidden
**原因**: 用户角色不匹配  
**解决**: 检查用户角色和端点权限要求

### 问题: 404 Not Found
**原因**: API 路径错误  
**解决**: 检查前端 API 调用路径

### 问题: 401 Unauthorized
**原因**: Token 无效或过期  
**解决**: 重新登录获取新 Token

### 问题: 422 Unprocessable Entity
**原因**: 请求数据格式错误  
**解决**: 检查请求数据格式和类型

---

## 📊 API 端点速查表

### 自评表相关
```
POST   /api/teaching-office/self-evaluation              创建考评表
GET    /api/teaching-office/self-evaluation/{id}         查询考评表
PUT    /api/teaching-office/self-evaluation/{id}         更新考评表
POST   /api/teaching-office/self-evaluation/{id}/submit  提交考评表
```

### 附件相关
```
POST   /api/teaching-office/attachments                  上传附件
GET    /api/teaching-office/attachments/{id}             查询附件
GET    /api/attachments/{id}/download                    下载附件
```

### 评分相关
```
POST   /api/scoring/manual-score                         提交评分
GET    /api/scoring/all-scores/{id}                      查询所有评分
POST   /api/scoring/final-score                          确定最终分数
GET    /api/scoring/audit                                查询审计记录
```

---

## 🔍 日志位置

### 后端日志
```
backend/error.log                  错误日志
backend/out.txt                    输出日志
```

### 前端日志
```
浏览器控制台 (F12)                 前端日志
```

---

## 📈 性能指标

| 指标 | 值 | 状态 |
|-----|-----|------|
| 登录响应时间 | < 100ms | ✅ 正常 |
| 创建考评表 | < 200ms | ✅ 正常 |
| 上传附件 | < 1s | ✅ 正常 |
| 查询数据 | < 100ms | ✅ 正常 |
| 评分提交 | < 200ms | ✅ 正常 |

---

## 🛡️ 安全检查清单

- ✅ JWT Token 验证正确
- ✅ 角色权限检查正确
- ✅ 数据隔离正确
- ✅ CORS 配置正确
- ✅ 密码加密正确
- ✅ SQL 注入防护正确

---

## 📞 支持信息

### 常见问题
1. **系统无法登录**: 检查用户名和密码
2. **权限被拒绝**: 检查用户角色
3. **文件上传失败**: 检查 MinIO 服务
4. **数据库连接失败**: 检查 MySQL 服务

### 联系方式
- 技术支持: 查看后端日志
- 问题报告: 提交 GitHub Issue
- 功能建议: 联系产品团队

---

## 📅 维护计划

### 日常维护
- 每天检查系统日志
- 监控 API 响应时间
- 备份数据库

### 定期维护
- 每周运行完整测试
- 每月更新依赖包
- 每季度进行安全审计

### 计划升级
- 添加更多功能
- 优化性能
- 改进用户体验

---

## 📚 相关文档

- `完整功能测试报告-2026-02-15.md` - 详细测试报告
- `系统修复完成总结-2026-02-15.md` - 修复总结
- `README.md` - 项目说明
- `DEPLOYMENT_GUIDE.md` - 部署指南

---

## ✅ 最后检查清单

在生产部署前，请确认:

- [ ] 所有测试通过
- [ ] 日志配置正确
- [ ] 数据库备份完成
- [ ] 环境变量配置正确
- [ ] SSL 证书配置正确
- [ ] 监控系统就位
- [ ] 告警规则配置
- [ ] 用户文档准备
- [ ] 支持团队培训
- [ ] 回滚计划准备

---

**最后更新**: 2026-02-15 16:46:17  
**系统状态**: ✅ 正常运行  
**下一步**: 生产部署
