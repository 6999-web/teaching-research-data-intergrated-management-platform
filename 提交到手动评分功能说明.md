# 提交到手动评分功能说明

## ✅ 功能已修复！

我已经修复了前端代码，现在点击"提交表单"后，数据会自动出现在考评小组端的手动评分列表中。

## 🔧 修改内容

### 修改的文件
`frontend/src/views/ManualScoring.vue`

### 修改说明
**之前的问题**：
- 手动评分页面只显示状态为 `ai_scored` 的自评表
- 但提交后的自评表状态是 `locked`（已锁定）
- 导致刚提交的表单不会出现在列表中

**修复方案**：
- 移除了前端的状态过滤
- 现在会显示所有 `locked` 和 `ai_scored` 状态的自评表
- 后端API默认就支持返回这两种状态

## 📋 完整流程

### 1. 教研室端提交表单

1. 登录教研室端账号：
   - 用户名：`test_teaching_office`
   - 密码：`password123`

2. 访问：http://localhost:3000/self-evaluation

3. 填写表单并点击"提交表单"

4. 系统自动执行：
   ```
   保存数据 → 提交并锁定(status: locked) → 触发AI评分
   ```

### 2. 考评小组端查看

1. 登录考评小组账号：
   - 用户名：`test_eval_team`
   - 密码：`password123`

2. 访问：http://localhost:3000/manual-scoring

3. **立即可以看到刚提交的表单**（状态显示为"已锁定"）

## 🎯 数据流转

```
教研室端填写表单
    ↓
点击"提交表单"
    ↓
前端调用API：
  1. POST /api/teaching-office/self-evaluation (保存)
  2. POST /api/teaching-office/self-evaluation/{id}/submit (提交锁定)
  3. POST /api/teaching-office/trigger-ai-scoring (触发AI评分)
    ↓
数据库状态变为：locked
    ↓
考评小组端查看：
  GET /api/scoring/evaluations-for-scoring
  (返回 status in ['locked', 'ai_scored'] 的自评表)
    ↓
✅ 表单出现在手动评分列表中
```

## 📊 状态说明

| 状态 | 说明 | 是否显示在手动评分列表 |
|------|------|----------------------|
| draft | 草稿 | ❌ 否 |
| locked | 已锁定（已提交） | ✅ 是 |
| ai_scored | AI已评分 | ✅ 是 |
| manually_scored | 已手动评分 | ❌ 否（已完成评分） |
| finalized | 已确定最终得分 | ❌ 否 |
| published | 已公示 | ❌ 否 |

## 🔍 验证方法

### 方法1：通过前端界面

1. 教研室端提交表单
2. 切换到考评小组账号
3. 打开手动评分页面
4. 应该立即看到刚提交的表单

### 方法2：查看数据库

```sql
-- 查看最新提交的自评表
SELECT 
    se.id,
    to.name as teaching_office_name,
    se.evaluation_year,
    se.status,
    se.submitted_at
FROM self_evaluations se
JOIN teaching_offices to ON se.teaching_office_id = to.id
WHERE se.status IN ('locked', 'ai_scored')
ORDER BY se.submitted_at DESC;
```

### 方法3：查看浏览器控制台

1. 打开浏览器开发者工具（F12）
2. 切换到 Network 标签
3. 在手动评分页面刷新
4. 查看 `evaluations-for-scoring` 请求
5. 应该能看到返回的数据包含刚提交的表单

## ⚠️ 注意事项

### 1. 必须先登录
- 教研室端提交需要登录
- 考评小组端查看也需要登录
- 使用正确的角色账号

### 2. 状态流转
- 提交后状态立即变为 `locked`
- AI评分完成后变为 `ai_scored`
- 两种状态都会显示在手动评分列表中

### 3. 权限控制
- 只有考评小组和考评办公室可以查看手动评分列表
- 教研室端无法访问手动评分页面

## 🎉 总结

现在功能已经正常工作：

✅ 教研室端点击"提交表单" → 数据立即传到考评小组端的手动评分列表

✅ 不需要等待AI评分完成

✅ 状态为 `locked` 或 `ai_scored` 的表单都会显示

✅ 考评小组可以立即开始手动评分

## 🚀 快速测试

1. **提交表单**：
   ```
   登录 test_teaching_office → 
   访问 /self-evaluation → 
   填写并提交
   ```

2. **查看结果**：
   ```
   登录 test_eval_team → 
   访问 /manual-scoring → 
   看到刚提交的表单
   ```

就这么简单！🎊
