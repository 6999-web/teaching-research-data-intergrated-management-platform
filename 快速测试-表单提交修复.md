# 快速测试指南 - 表单提交修复

## 问题
教研室端无法提交表单，报错：`ElMessage.loading is not a function`

## 修复内容
修复了 `handleSubmit` 函数中错误的 `ElMessage.loading()` 调用方式。

## 测试环境
- 前端: http://localhost:3000 ✅ 运行中
- 后端: http://localhost:8000 ✅ 运行中

## 测试账号
```
用户名: office1
密码: password123
```

## 测试步骤

### 1. 刷新页面
1. 在浏览器中按 `Ctrl + Shift + R` 强制刷新页面
2. 或者按 `F5` 刷新页面
3. 确保加载最新的代码

### 2. 登录系统
1. 访问: http://localhost:3000
2. 输入账号: `office1`
3. 输入密码: `password123`
4. 点击"登录"

### 3. 填写自评表
1. 点击左侧菜单"填写自评表"
2. 填写所有必填项（8个常规教学工作项目）
   - 每项至少输入10个字符
   - 输入自评分（0-10分）

示例内容：
```
教学过程管理：
制定了详细的年度教研室工作计划，定期召开教研活动，
落实集体备课制度，完成了毕业论文指导工作。

自评分：8分
```

### 4. 提交表单
1. 滚动到页面底部
2. 点击"提交表单"按钮
3. 观察提交过程

### 5. 验证提交流程
观察页面右上角的消息提示：

**预期显示顺序：**
1. ⏳ "正在提交自评表，请稍候..."
2. ⏳ "正在提交到考评小组，请稍候..."
3. ✅ "提交成功！数据已上传到考评小组端"

**如果上传了附件：**
1. ⏳ "正在提交自评表，请稍候..."
2. ⏳ "正在上传附件，请稍候..."
3. ⏳ "正在提交到考评小组，请稍候..."
4. ✅ "提交成功！数据已上传到考评小组端"

### 6. 检查控制台
1. 按 `F12` 打开开发者工具
2. 切换到 `Console` 标签
3. 确认没有错误信息
4. 应该看不到 `ElMessage.loading is not a function` 错误

## 预期结果

### ✅ 成功标志
- 没有控制台错误
- 显示清晰的加载提示
- 提交成功后显示绿色成功消息
- 表单数据已保存到数据库

### ❌ 如果仍然失败
检查以下几点：
1. 是否已刷新页面？
2. 是否已登录？
3. 是否填写了所有必填项？
4. 后端服务是否正常运行？

## 测试场景

### 场景1：只提交表单（不上传附件）
1. 填写所有必填项
2. 不上传附件
3. 点击"提交表单"
4. 预期：成功提交

### 场景2：提交表单并上传附件
1. 填写所有必填项
2. 选择考核指标
3. 上传1-2个文件
4. 点击"提交表单并上传附件"
5. 预期：表单和附件都成功提交

### 场景3：测试错误处理
1. 退出登录
2. 尝试提交表单
3. 预期：显示"请先登录后再提交"并跳转到登录页

## 调试信息

### 查看网络请求
1. 打开开发者工具（F12）
2. 切换到 `Network` 标签
3. 提交表单
4. 查看以下请求：
   - `POST /api/teaching-office/self-evaluations` - 保存自评表
   - `POST /api/teaching-office/attachments` - 上传附件（如果有）
   - `POST /api/teaching-office/self-evaluations/{id}/submit` - 提交并锁定
   - `POST /api/teaching-office/self-evaluations/{id}/trigger-ai-scoring` - 触发AI评分

### 查看请求状态
- 200/201: 成功
- 401: 未登录
- 403: 权限不足
- 404: 接口不存在
- 500: 服务器错误

## 常见问题

### Q1: 仍然看到 `ElMessage.loading is not a function` 错误？
A: 强制刷新页面（Ctrl + Shift + R），清除浏览器缓存

### Q2: 提交按钮是灰色的？
A: 检查是否填写了所有必填项（8个常规教学工作项目）

### Q3: 提交后没有任何反应？
A: 打开控制台查看错误信息，检查网络请求

### Q4: 显示403错误？
A: 重新登录，确保有正确的权限

### Q5: 附件上传失败？
A: 检查文件大小（不超过50MB）和格式

## 成功标志
- ✅ 没有控制台错误
- ✅ 加载提示正常显示
- ✅ 提交成功消息显示
- ✅ 数据保存到数据库

## 下一步
测试成功后，可以：
1. 测试"结果查看"功能
2. 测试"下学期改进措施"功能
3. 测试其他角色的功能
4. 进行完整的端到端测试

## 技术说明

### 修复前的错误代码
```typescript
ElMessage.loading('正在提交...')  // ❌ 错误
```

### 修复后的正确代码
```typescript
const loadingMessage = ElMessage({
  message: '正在提交...',
  type: 'info',
  duration: 0,
  showClose: false
})

// 使用完后关闭
loadingMessage.close()  // ✅ 正确
```

## 相关文档
- `表单提交错误修复-2026-02-14.md` - 详细修复说明
- `教研室端界面更新说明.md` - 界面更新说明
- `表单提交和附件上传修复完成.md` - 之前的修复说明
