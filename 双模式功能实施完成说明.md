# 双模式功能实施完成说明

## 📋 概述

成功在教研室数据管理平台中实现了**双模式切换功能**，用户可以在**三端模式**（原有功能）和**四角色模式**（新增功能）之间自由切换。

---

## 🎯 实现的功能

### 1. 双模式支持

系统现在支持两种工作模式：

#### 三端模式（原有）
- **教研室端**: 自评填写、材料上传、结果查看
- **管理端**: 手动评分、最终得分、异常处理、公示管理
- **校长办公会端**: 数据监控、结果审定

#### 四角色模式（新增）
- **普通教师**: 查看本教研室考评结果、数据分析
- **教研室负责人**: 自评管理、材料管理、AI评分、改进闭环
- **二级学院负责人**: 学院驾驶舱、整改督导
- **学校教务处负责人**: 监控中心、评分管理、异常处理、公示管理

### 2. 模式切换功能

- **切换按钮**: 在左侧导航栏顶部添加了模式切换按钮
- **状态保持**: 切换模式后，系统会记住用户的选择（使用 localStorage）
- **自动重置**: 切换模式时自动重置到默认模块和标签页
- **图标显示**: 使用 Element Plus 的 Switch 图标表示切换功能

### 3. 流程条显示

- **四角色模式**: 显示8步流程条，根据角色高亮相关节点
- **三端模式**: 不显示流程条（保持原有设计）

### 4. 角色徽章

- **四角色模式**: 显示当前角色名称（如"教研室负责人"）
- **三端模式**: 显示当前端口名称（如"教研室端"）

---

## 🔧 技术实现

### 修改的文件

1. **frontend/src/views/Home.vue**
   - 添加 `isRoleMode` 响应式变量控制模式
   - 添加 `toggleMode()` 函数切换模式
   - 添加 `threePortModules` 和 `fourRoleModules` 数据
   - 添加 `threePortTabs` 和 `fourRoleTabs` 数据
   - 添加 `threePortFunctions` 和 `fourRoleFunctions` 数据
   - 使用 `computed` 属性动态切换数据源
   - 添加模式切换按钮到侧边栏
   - 条件渲染流程条（仅四角色模式显示）
   - 更新 `selectModule()` 函数，仅在四角色模式下更新角色
   - 更新 `goToHome()` 函数，根据模式重置到不同默认值
   - 添加模式切换按钮样式
   - 调整侧边栏宽度从 200px 到 220px（容纳切换按钮）

### 核心代码逻辑

```typescript
// 模式切换
const isRoleMode = ref(false)

// 动态模块
const modules = computed(() => {
  return isRoleMode.value ? fourRoleModules.value : threePortModules.value
})

// 切换模式
const toggleMode = () => {
  isRoleMode.value = !isRoleMode.value
  activeModule.value = 0
  activeTab.value = 0
  localStorage.setItem('viewMode', isRoleMode.value ? 'role' : 'port')
}

// 恢复模式设置
onMounted(() => {
  authStore.loadFromStorage()
  const savedMode = localStorage.getItem('viewMode')
  if (savedMode === 'role') {
    isRoleMode.value = true
    const roleIndex = fourRoleModules.value.findIndex(m => m.role === authStore.userRole)
    if (roleIndex !== -1) {
      activeModule.value = roleIndex
    }
  }
})
```

---

## 📊 数据结构

### 三端模式数据

```typescript
// 三端模块
const threePortModules = [
  { name: '教研室端', icon: Edit },
  { name: '管理端', icon: Setting },
  { name: '校长办公会端', icon: Monitor }
]

// 三端标签页（每个端口有不同的标签页）
const threePortTabs = [
  // 教研室端: 2个标签页
  [
    { name: '详教方案', icon: Document },
    { name: '分发材料', icon: Upload }
  ],
  // 管理端: 3个标签页
  [
    { name: '监控中心', icon: TrendCharts },
    { name: '分析中心', icon: DataAnalysis },
    { name: '应用中心', icon: Setting }
  ],
  // 校长办公会端: 2个标签页
  [
    { name: '数据看板', icon: Monitor },
    { name: '审批中心', icon: CircleCheck }
  ]
]

// 三端功能列表（每个标签页有不同的功能卡片）
const threePortFunctions = [
  // 教研室端功能
  [
    // 详教方案标签页
    [
      { name: '填写自评表', route: '/self-evaluation', ... },
      { name: '查看结果', route: '/result/eval-123', ... }
    ],
    // 分发材料标签页
    [
      { name: '上传附件', route: '/attachment-upload', ... },
      { name: '附件管理', route: '/attachment-management', ... }
    ]
  ],
  // 管理端功能
  [...],
  // 校长办公会端功能
  [...]
]
```

### 四角色模式数据

```typescript
// 四角色模块
const fourRoleModules = [
  { name: '普通教师', icon: User, role: 'teacher' },
  { name: '教研室负责人', icon: Edit, role: 'director' },
  { name: '二级学院负责人', icon: Histogram, role: 'college_leader' },
  { name: '学校教务处负责人', icon: Setting, role: 'academic_affairs' }
]

// 四角色标签页（每个角色有不同的标签页）
const fourRoleTabs = [
  // 普通教师: 2个标签页
  [
    { name: '我的教研室', icon: Document },
    { name: '数据分析', icon: DataAnalysis }
  ],
  // 教研室负责人: 4个标签页
  [
    { name: '自评管理', icon: EditPen },
    { name: '材料管理', icon: Upload },
    { name: 'AI评分', icon: Monitor },
    { name: '改进闭环', icon: CircleCheck }
  ],
  // 二级学院负责人: 2个标签页
  [...],
  // 学校教务处负责人: 4个标签页
  [...]
]

// 四角色功能列表（每个标签页有不同的功能卡片）
const fourRoleFunctions = [
  // 普通教师功能
  [...],
  // 教研室负责人功能
  [...],
  // 二级学院负责人功能
  [...],
  // 学校教务处负责人功能
  [...]
]
```

---

## 🎨 界面变化

### 侧边栏

1. **宽度调整**: 从 200px 增加到 220px
2. **新增切换按钮**: 在侧边栏顶部（校徽下方）添加模式切换按钮
3. **角色徽章**: 根据模式显示不同内容
   - 三端模式: 显示端口名称
   - 四角色模式: 显示角色名称

### 主内容区

1. **流程条**: 仅在四角色模式下显示
2. **标签页**: 根据模式显示不同的标签页
3. **功能卡片**: 根据模式和选中的标签页显示不同的功能

### 响应式设计

- 在移动端（宽度 < 768px）时，模式切换按钮会隐藏
- 侧边栏会收缩为图标模式

---

## 🔄 用户操作流程

### 切换到四角色模式

1. 点击侧边栏顶部的"切换到四角色模式"按钮
2. 系统自动切换到四角色模式
3. 侧边栏显示四个角色选项
4. 主内容区显示流程条
5. 系统记住用户选择（下次打开自动恢复）

### 切换到三端模式

1. 点击侧边栏顶部的"切换到三端模式"按钮
2. 系统自动切换到三端模式
3. 侧边栏显示三个端口选项
4. 主内容区不显示流程条
5. 系统记住用户选择（下次打开自动恢复）

---

## ✅ 测试建议

### 功能测试

1. **模式切换测试**
   - 点击切换按钮，验证模式是否正确切换
   - 验证侧边栏菜单是否正确更新
   - 验证标签页是否正确更新
   - 验证功能卡片是否正确更新

2. **状态保持测试**
   - 切换到四角色模式，刷新页面，验证是否保持四角色模式
   - 切换到三端模式，刷新页面，验证是否保持三端模式

3. **流程条显示测试**
   - 在四角色模式下，验证流程条是否显示
   - 在三端模式下，验证流程条是否隐藏

4. **角色切换测试**（四角色模式）
   - 切换不同角色，验证标签页和功能卡片是否正确更新
   - 验证角色徽章是否正确显示

5. **端口切换测试**（三端模式）
   - 切换不同端口，验证标签页和功能卡片是否正确更新
   - 验证端口名称是否正确显示

### 响应式测试

1. 在不同屏幕尺寸下测试（桌面、平板、手机）
2. 验证移动端时模式切换按钮是否隐藏
3. 验证侧边栏收缩时功能是否正常

---

## 📝 后续优化建议

1. **权限控制**: 根据用户实际权限动态显示可用的模式和角色
2. **数据同步**: 确保两种模式下的数据一致性
3. **用户引导**: 首次使用时显示模式切换的引导提示
4. **快捷键**: 添加键盘快捷键快速切换模式（如 Ctrl+M）
5. **动画效果**: 添加模式切换时的过渡动画，提升用户体验

---

## 🎉 总结

成功实现了双模式功能，用户现在可以：

1. ✅ 在三端模式和四角色模式之间自由切换
2. ✅ 系统自动记住用户的模式选择
3. ✅ 两种模式下都有完整的功能支持
4. ✅ 界面设计保持一致性和专业性
5. ✅ 响应式设计适配不同设备

这个实现既保留了原有的三端模式功能，又增加了新的四角色模式，满足了不同用户的需求，提供了更灵活的使用方式。
