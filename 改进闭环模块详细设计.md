# 改进闭环模块详细设计方案 (Design Spec v1.1)

## 1. 界面设计原型 (UI Mockups)

### 1.1 普通教师端 - 我的考评
**设计目标**: 清晰展示结果，传达反馈，不增加额外操作负担。

```text
+---------------------------------------------------------------+
|  PageHeader: 2025-2026第一学期教研室考评结果 [返回]           |
+---------------------------------------------------------------+
|  [ 概览卡片 ]                                                 |
|  +----------------+  +----------------+  +----------------+   |
|  | 最终得分       |  | 全校排名       |  | 评级           |   |
|  | 88.5           |  | 12 / 45        |  | 良好           |   |
|  +----------------+  +----------------+  +----------------+   |
+---------------------------------------------------------------+
|  [ 详情分析 ]                                                 |
|  [ 雷达图区域: 本教研室得分 vs 全校平均 vs 学院平均 ]         |
+---------------------------------------------------------------+
|  [ 反馈与明细 ]                                               |
|  +---------------------------------------------------------+  |
|  | 指标项      | 得分 | 扣分原因 / 评语               |      |  |
|  +---------------------------------------------------------+  |
|  | 教学档案    | 8/10 | 缺少第3周教研活动记录         |      |  |
|  +---------------------------------------------------------+  |
|  | 课程建设    | 15/20| 省级课题申报材料格式不规范... |      |  |
|  +---------------------------------------------------------+  |
|  | ...         | ...  | ...                           |      |  |
|  +---------------------------------------------------------+  |
+---------------------------------------------------------------+
```

### 1.2 教研室主任端 - 改进措施填报
**设计目标**: 将问题转化为行动，便捷指派任务。

```text
+---------------------------------------------------------------+
|  PageHeader: 考评整改计划填报 (状态: 待提交)                  |
+---------------------------------------------------------------+
|  [ 问题清单与整改 ]                                           |
|                                                               |
|  1. 教学档案 (扣分: 2分)                                      |
|  -----------------------------------------------------------  |
|  详情: 缺少第3周教研活动记录                                  |
|  [ 表单区域 ]                                                 |
|  整改目标: [ 补齐缺失记录，建立从下月起的检查机制       ]     |
|  具体措施: [ 1. 指定张三负责补录...                     ]     |
|            [ 2. 启用新的活动记录模板...                 ]     |
|  责任人:   [ 王老师 v ]   截止时间: [ 2026-03-01 (#) ]        |
|                                                               |
|  2. 课程建设 (扣分: 5分)                                      |
|  -----------------------------------------------------------  |
|  详情: ...                                                    |
|  [ + 添加整改措施 ]                                           |
|                                                               |
+---------------------------------------------------------------+
|  [ 提交给学院审核 ]  [ 保存草稿 ]                             |
+---------------------------------------------------------------+
```

### 1.3 二级学院领导端 - 质量监测驾驶舱
**设计目标**: 宏观把控，一键督导。

```text
+---------------------------------------------------------------+
|  PageHeader: 信息工程学院 - 考评质量监测驾驶舱                |
+---------------------------------------------------------------+
|  [ 关键指标 ]                                                 |
|  平均分: 85.4  |  最高分: 软件工程教研室  |  待整改数: 5      |
+---------------------------------------------------------------+
|  [ 学院概览图表 ]                                             |
|                                                               |
|  ^ 分数                                                       |
|  |         [=]      [=]                                   |
|  | [=]     [=] [=]  [=]                                   |
|  | [=] [=] [=] [=]  [=]      (各教研室排名对比)           |
|  +------------------------------- > 教研室                    |
|                                                               |
+---------------------------------------------------------------+
|  [ 整改督导列表 ]                                             |
|  +---------------------------------------------------------+  |
|  | 教研室   | 扣分痛点 | 整改状态 | 进度 | 操作            |  |
|  +---------------------------------------------------------+  |
|  | 软件工程 | 师资培养 | 审核通过 | 60%  | [查看进度]      |  |
|  +---------------------------------------------------------+  |
|  | 大数据   | 教学运行 | 待审核   | 0%   | [审核/批注]     |  |
|  +---------------------------------------------------------+  |
+---------------------------------------------------------------+
```

---

## 2. API 接口定义 (RESTful)

### 2.1 核心数据接口

#### 获取考评结果详情
*   **URL**: `GET /api/v1/evaluations/{evaluation_id}/result`
*   **权限**: 教师(仅看自己)、主任(仅看自己)、学院领导(看全院)、校级(看全校)
*   **Response**:
    ```json
    {
      "score": 88.5,
      "rank": 12,
      "radar_data": { "teaching": 85, "research": 70, ... },
      "items": [
        { "indicator": "教学档案", "score": 8, "max_score": 10, "comment": "缺少记录..." }
      ]
    }
    ```

#### 提交/更新改进措施
*   **URL**: `POST /api/v1/improvements`
*   **权限**: 教研室主任
*   **Request**:
    ```json
    {
      "evaluation_item_id": 101,
      "target": "补齐缺失记录...",
      "measures": "1. 指定专人...",
      "charger_id": "user_123",
      "deadline": "2026-03-01"
    }
    ```

#### 审核/批注改进措施
*   **URL**: `POST /api/v1/improvements/{plan_id}/review`
*   **权限**: 二级学院领导
*   **Request**:
    ```json
    {
      "status": "APPROVED", // 或 "REJECTED"
      "comment": "措施不够具体，请补充如何避免再次发生。"
    }
    ```

#### 学院驾驶舱数据
*   **URL**: `GET /api/v1/dashboard/college/stats`
*   **权限**: 二级学院领导
*   **Response**:
    ```json
    {
      "avg_score": 85.4,
      "rank_list": [
        { "name": "软件工程教研室", "score": 92 },
        { "name": "网络工程教研室", "score": 81 }
      ],
      "weakness_analysis": [
        { "indicator": "师资培养", "avg_loss_rate": 0.4 } // 该项平均失分率
      ]
    }
    ```

---

## 3. 数据库模型设计变更

为了支持上述功能，需要对后端数据库 Schema 进行扩展。

### 3.1 新增表: `improvement_plans` (整改计划)
| 字段名 | 类型 | 说明 |
| :--- | :--- | :--- |
| `id` | UUID | 主键 |
| `evaluation_result_id` | UUID | 关联的考评结果ID |
| `indicator_item_id` | INT | 关联的具体指标项ID |
| `target` | TEXT | 整改目标 |
| `measures` | TEXT | 具体措施 |
| `charger_id` | UUID | 责任人ID (关联User表) |
| `deadline` | DATE | 预计完成时间 |
| `status` | VARCHAR | 状态: PENDING, APPROVED, REJECTED, COMPLETED |
| `supervisor_comment` | TEXT | 学院领导批注 |
| `created_at` | DATETIME | 创建时间 |
| `updated_at` | DATETIME | 更新时间 |

### 3.2 修改表: `users`
*   新增字段 `college_id` (FK to Colleges): 关联二级学院
*   更新 `role` 枚举: 增加 `DEAN` (院长/学院领导)

### 3.3 新增表: `colleges` (二级学院)
| 字段名 | 类型 | 说明 |
| :--- | :--- | :--- |
| `id` | INT | 主键 |
| `name` | VARCHAR | 学院名称 |
| `dean_id` | UUID | 院长ID |
