# 提交功能测试指南

## 修复内容
已修复"请先保存表单后再提交"的问题，现在点击"提交表单"按钮可以直接完成保存和提交操作。

## 测试步骤

### 1. 访问自评表页面
```
http://localhost:3000/self-evaluation
```

### 2. 填写表单
填写以下三个部分：

#### 一、常规教学工作（8项指标，每项10分）
1. 教学过程管理
2. 教学质量管理
3. 课程考核
4. 教育教学科研工作
5. 课程建设
6. 教师队伍建设
7. 科学研究与学术交流
8. 教研室管理

每项需要填写：
- 内容描述（文本框）
- 自评分（0-10分）

#### 二、特色与亮点项目
1. 荣誉奖项（可添加多项）
   - 名称、级别、分数
2. 竞赛获奖（可添加多项）
   - 名称、级别、分数
3. 教学创新（可添加多项）
   - 名称、描述、分数
4. 教改项目（可添加多项）
   - 名称、描述、分数

#### 三、负面清单（扣分项）
1. 教学事故次数
2. 学生投诉次数
3. 违规违纪次数
4. 其他负面事项

### 3. 点击"提交表单"按钮

**预期行为**:
1. 弹出确认对话框："提交后表单将被锁定，无法修改。确定要提交吗？"
2. 点击"确定"后，系统开始处理

### 4. 观察提示信息

**应该看到以下提示（按顺序）**:
1. ℹ️ "正在提交自评表..."
2. ✅ "自评表保存成功"
3. ✅ "自评表提交成功，已锁定"
4. ❓ 弹出对话框："自评表已提交，是否立即触发AI评分？"
   - 点击"立即评分"：继续AI评分流程
   - 点击"稍后评分"：跳过AI评分

### 5. 如果选择"立即评分"

**预期行为**:
1. ✅ "AI评分已启动，请稍后查看结果"
2. ✅ "操作完成，即将返回主页"
3. 1.5秒后自动跳转到教研室主页

### 6. 验证提交结果

#### 方法1：查看考评小组端
1. 访问手动评分页面：
   ```
   http://localhost:3000/manual-scoring
   ```
2. 应该能看到刚提交的自评表
3. 状态应该显示为"AI已评分"（如果触发了AI评分）或"已锁定"

#### 方法2：查看后端日志
查看后端进程输出，应该能看到：
- POST /api/teaching-office/self-evaluation (保存)
- POST /api/teaching-office/self-evaluation/{id}/submit (提交)
- POST /api/teaching-office/trigger-ai-scoring (AI评分，如果触发)

## 常见问题排查

### 问题1：点击提交后没有反应
**可能原因**:
- 表单验证失败
- 网络连接问题
- 后端服务未启动

**解决方法**:
1. 检查浏览器控制台是否有错误信息
2. 确保所有必填项都已填写
3. 检查后端服务是否运行：http://localhost:8000/docs

### 问题2：提示"提交失败，请重试"
**可能原因**:
- 未登录或token过期
- 后端API错误
- 数据库连接问题

**解决方法**:
1. 重新登录获取新的token
2. 查看后端日志了解具体错误
3. 检查MySQL数据库是否运行

### 问题3：AI评分失败
**可能原因**:
- 没有上传附件
- AI服务配置问题
- 后台任务执行失败

**解决方法**:
1. 确保已上传附件
2. 查看后端日志了解AI评分错误
3. AI评分失败不影响提交结果，可以稍后重试

### 问题4：在手动评分页面看不到提交的自评表
**可能原因**:
- AI评分尚未完成
- 状态不是 `ai_scored`
- 权限问题

**解决方法**:
1. 等待AI评分完成（通常需要几秒到几分钟）
2. 检查自评表状态是否为 `ai_scored`
3. 确保使用考评小组或考评办公室账号登录

## 测试数据示例

### 常规教学工作示例
```
1. 教学过程管理
内容：制定了完整的年度教研室工作计划，采取有效措施保证计划落实，各个教学环节运转正常。
自评分：9.5

2. 教学质量管理
内容：定期了解教研室成员教学情况，组织教师相互听课学习，开展教学评议活动。
自评分：9.0

... (其他6项类似)
```

### 特色亮点项目示例
```
荣誉奖项：
- 优秀教学团队，省级，5分

竞赛获奖：
- 教学技能大赛一等奖，国家级，10分

教学创新：
- 翻转课堂教学模式，3分

教改项目：
- 混合式教学改革，4分
```

### 负面清单示例
```
教学事故：0次
学生投诉：0次
违规违纪：0次
其他：0次
```

## 预期结果

### 成功提交后
1. ✅ 表单数据保存到数据库
2. ✅ 自评表状态变为 `locked`
3. ✅ （可选）AI评分任务启动
4. ✅ AI评分完成后状态变为 `ai_scored`
5. ✅ 在考评小组端的手动评分列表中可见

### 数据库验证
可以查询数据库确认：
```sql
-- 查看自评表
SELECT id, teaching_office_id, evaluation_year, status, submitted_at 
FROM self_evaluations 
ORDER BY created_at DESC 
LIMIT 1;

-- 查看AI评分记录
SELECT id, evaluation_id, total_score, scored_at 
FROM ai_scores 
ORDER BY scored_at DESC 
LIMIT 1;
```

## 注意事项

1. **首次测试前**
   - 确保已登录
   - 确保后端和前端服务都在运行
   - 确保MySQL数据库已启动

2. **测试过程中**
   - 注意观察每一步的提示信息
   - 如果出现错误，记录错误信息
   - 可以打开浏览器开发者工具查看网络请求

3. **测试完成后**
   - 验证数据是否正确保存
   - 验证状态流转是否正确
   - 验证在手动评分页面是否可见

## 服务状态检查

### 前端服务
```
http://localhost:3000
```
应该能正常访问

### 后端服务
```
http://localhost:8000/docs
```
应该能看到API文档

### 数据库
```bash
mysql -u root -p
use teaching_office_evaluation;
show tables;
```
应该能看到所有表

## 完成标准

测试通过的标准：
- ✅ 能够填写完整的自评表
- ✅ 点击提交按钮后能看到正确的提示信息
- ✅ 能够选择是否触发AI评分
- ✅ 提交成功后能自动跳转到主页
- ✅ 在考评小组端能看到提交的自评表
- ✅ 自评表状态正确（locked 或 ai_scored）

## 联系支持

如果测试过程中遇到问题：
1. 查看浏览器控制台错误
2. 查看后端日志
3. 查看数据库数据
4. 参考 `提交按钮修复说明.md` 文档
