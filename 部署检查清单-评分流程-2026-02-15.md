# 评分流程修复 - 部署检查清单

**修复日期**: 2026-02-15  
**检查日期**: 2026-02-15  

---

## ✅ 代码修改检查

### 后端修改
- [ ] `backend/app/api/v1/endpoints/auth.py` - 登录响应修改
  - [ ] 验证仅为 teaching_office 返回 teaching_office_id
  - [ ] 验证其他角色返回 None
  
- [ ] `backend/app/api/v1/endpoints/scoring.py` - 权重函数修改
  - [ ] 验证 evaluator 权重为 0.70
  - [ ] 验证 evaluation_team 权重为 0.70
  - [ ] 验证 evaluation_office 权重为 0.50

- [ ] `backend/app/api/v1/endpoints/scoring.py` - 权限检查修改
  - [ ] 验证 RoleChecker 包括 evaluator
  - [ ] 验证 RoleChecker 包括 evaluation_team
  - [ ] 验证 RoleChecker 包括 evaluation_office

### 前端修改
- [ ] `frontend/src/components/ManualScoringForm.vue` - API 路径修改
  - [ ] 验证 loadAttachments 使用正确的路径
  - [ ] 验证 handleDownloadAttachment 使用正确的路径

---

## 🧪 功能测试检查

### 后端测试
- [ ] 教研室用户登录
  - [ ] 验证返回 teachingOfficeId (非空)
  - [ ] 验证返回正确的 role
  - [ ] 验证返回有效的 token

- [ ] evaluator 用户登录
  - [ ] 验证返回 teachingOfficeId: null
  - [ ] 验证返回正确的 role
  - [ ] 验证返回有效的 token

- [ ] evaluator 提交评分
  - [ ] 验证 POST /scoring/manual-score 返回 201
  - [ ] 验证评分记录正确保存
  - [ ] 验证权重正确计算

- [ ] evaluator 加载附件
  - [ ] 验证 GET /attachments/{id} 返回 200
  - [ ] 验证返回正确的附件列表
  - [ ] 验证附件元数据完整

- [ ] evaluator 下载附件
  - [ ] 验证 GET /attachments/{id}/download 返回 200
  - [ ] 验证文件正确下载
  - [ ] 验证文件内容正确

### 前端测试
- [ ] evaluator 用户登录
  - [ ] 验证登录成功
  - [ ] 验证导航到评分页面
  - [ ] 验证显示待评分列表

- [ ] evaluator 加载考评表
  - [ ] 验证考评表内容正确加载
  - [ ] 验证没有 403 错误
  - [ ] 验证显示完整的考评表数据

- [ ] evaluator 加载附件
  - [ ] 验证附件列表正确加载
  - [ ] 验证没有 403 错误
  - [ ] 验证显示所有附件

- [ ] evaluator 下载附件
  - [ ] 验证附件正确下载
  - [ ] 验证没有 403 错误
  - [ ] 验证文件名正确

- [ ] evaluator 提交评分
  - [ ] 验证评分表单正确显示
  - [ ] 验证评分提交成功
  - [ ] 验证没有 400 错误
  - [ ] 验证评分记录保存

---

## 🔐 权限检查

### 权限隔离测试
- [ ] teaching_office 不能调用 POST /scoring/manual-score
  - [ ] 验证返回 403 Forbidden
  
- [ ] evaluator 不能调用 POST /teaching-office/self-evaluation
  - [ ] 验证返回 403 Forbidden
  
- [ ] evaluator 不能调用 POST /teaching-office/attachments
  - [ ] 验证返回 403 Forbidden

### 数据隔离测试
- [ ] evaluator 只能看到已提交的考评表
  - [ ] 验证不能看到草稿状态的考评表
  
- [ ] evaluator 只能看到相关的附件
  - [ ] 验证不能看到其他教研室的附件

---

## 📊 数据库检查

- [ ] 用户角色正确配置
  - [ ] director1 角色为 teaching_office
  - [ ] evaluator1 角色为 evaluator
  
- [ ] 评分记录正确保存
  - [ ] 验证 manual_scores 表有新记录
  - [ ] 验证 reviewer_role 正确
  - [ ] 验证 weight 正确
  
- [ ] 权重正确计算
  - [ ] 验证 evaluator 权重为 0.70
  - [ ] 验证 evaluation_team 权重为 0.70
  - [ ] 验证 evaluation_office 权重为 0.50

---

## 🚀 部署检查

### 后端部署
- [ ] 代码已提交到 git
- [ ] 后端已重启
- [ ] 后端日志正常
- [ ] 没有错误信息

### 前端部署
- [ ] 代码已提交到 git
- [ ] 前端已重新构建
- [ ] 前端已重启
- [ ] 浏览器缓存已清除

### 环境检查
- [ ] 数据库连接正常
- [ ] API 服务正常
- [ ] 文件存储正常
- [ ] 日志系统正常

---

## 📝 文档检查

- [ ] 修复报告已生成
- [ ] 快速参考已生成
- [ ] 代码变更详情已生成
- [ ] 部署检查清单已生成

---

## 🔍 日志检查

### 后端日志
- [ ] 没有 500 错误
- [ ] 没有 403 错误（除了预期的权限检查）
- [ ] 没有数据库连接错误
- [ ] RoleChecker 日志正常

### 前端日志
- [ ] 没有 JavaScript 错误
- [ ] 没有 API 调用错误
- [ ] 没有 CORS 错误
- [ ] 网络请求正常

---

## ✨ 最终验证

### 完整流程测试
- [ ] 教研室端完整流程
  - [ ] 登录 → 创建考评表 → 上传附件 → 提交
  
- [ ] 评委端完整流程
  - [ ] 登录 → 加载考评表 → 查看附件 → 评分 → 提交

### 性能检查
- [ ] 登录响应时间 < 1s
- [ ] 加载考评表 < 2s
- [ ] 加载附件 < 2s
- [ ] 提交评分 < 2s

### 用户体验检查
- [ ] 错误提示清晰
- [ ] 成功提示清晰
- [ ] 界面响应快速
- [ ] 没有卡顿

---

## 📋 签字确认

| 项目 | 检查人 | 日期 | 签字 |
|-----|-------|------|------|
| 代码修改 | | | |
| 功能测试 | | | |
| 权限检查 | | | |
| 部署检查 | | | |
| 最终验证 | | | |

---

## 🎯 部署状态

- [ ] 所有检查项已完成
- [ ] 所有测试已通过
- [ ] 所有文档已生成
- [ ] 已准备好生产部署

---

## 📞 联系方式

如有问题，请联系:
- 技术支持: [support@example.com]
- 项目经理: [pm@example.com]
- 系统管理员: [admin@example.com]

---

**检查完成日期**: 2026-02-15  
**检查状态**: ✅ 完成  
**部署状态**: ✅ 准备就绪
