# 手动评分页面优化完成

## 完成时间
2026-02-13

## 修改内容

### 1. 删除AI评分标签页
- 移除了"AI评分"标签页及其相关内容
- 删除了AI评分相关的状态变量（`aiScoreLoading`、`aiScore`）
- 删除了`loadAIScore()`函数
- 从`onMounted`中移除了AI评分数据加载

### 2. 修正字段名称（英文改中文）
将附件表格中的字段名从驼峰命名改为下划线命名，与后端API返回的数据格式一致：

**修改前（驼峰命名）：**
- `fileName` → `file_name`
- `fileSize` → `file_size`
- `uploadedAt` → `uploaded_at`

**修改后（下划线命名）：**
```vue
<el-table-column prop="file_name" label="文件名" />
<el-table-column prop="file_size" label="文件大小" />
<el-table-column prop="uploaded_at" label="上传时间" />
```

同时修正了下载附件时的文件名获取：
```typescript
link.setAttribute('download', attachment.file_name || 'attachment')
```

### 3. 调整页面宽度
使三个标签页的内容宽度与下方卡片保持一致：

**修改前：**
```css
.manual-scoring-form {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}
```

**修改后：**
```css
.manual-scoring-form {
  width: 100%;
  max-width: 100%;
  margin: 0;
  padding: 0;
}

.scoring-tabs :deep(.el-tabs__content) {
  padding: 0;
}
```

## 当前标签页结构

现在手动评分页面包含3个标签页：

1. **自评表内容** - 显示教研室填写的完整自评表
2. **附件材料** - 显示上传的附件列表，支持下载
3. **手动评分** - 进行人工评分和查看所有评审人打分

## 页面布局

```
┌─────────────────────────────────────────────────┐
│  [自评表内容] [附件材料] [手动评分]              │
├─────────────────────────────────────────────────┤
│                                                 │
│  标签页内容区域（全宽显示）                      │
│                                                 │
└─────────────────────────────────────────────────┘
```

## 数据加载优化

简化了数据加载逻辑，只加载必要的数据：

```typescript
onMounted(async () => {
  await Promise.all([
    loadSelfEvaluation(),  // 加载自评表内容
    loadAttachments()       // 加载附件列表
  ])
})
```

## 字段映射说明

### 后端返回的附件数据格式
```json
{
  "id": "uuid",
  "evaluation_id": "uuid",
  "indicator": "考核指标",
  "file_name": "文件名.pdf",
  "file_size": 1024000,
  "file_type": "application/pdf",
  "uploaded_at": "2024-01-01T00:00:00",
  "is_archived": true
}
```

### 前端显示字段
- `indicator` - 考核指标
- `file_name` - 文件名
- `file_size` - 文件大小（格式化显示）
- `uploaded_at` - 上传时间（格式化显示）

## 测试建议

1. **自评表内容显示**
   - 检查是否正确显示所有章节
   - 检查自评分是否正确显示
   - 检查内容格式是否正确

2. **附件材料**
   - 检查附件列表是否完整
   - 测试附件下载功能
   - 检查文件大小和时间格式

3. **手动评分**
   - 确保原有功能正常
   - 测试评分提交
   - 测试查看所有评审人打分

4. **页面宽度**
   - 检查三个标签页内容宽度是否一致
   - 检查是否与下方卡片宽度对齐
   - 测试不同屏幕尺寸下的显示效果

## 相关文件
- `frontend/src/components/ManualScoringForm.vue` - 主要修改文件
- `手动评分页面增强完成.md` - 之前的功能增强文档
- `formatDateTime重复声明问题修复.md` - 之前的问题修复文档

## 注意事项

1. 后端API返回的字段名使用下划线命名（snake_case）
2. 前端需要使用相同的命名方式访问数据
3. 页面宽度已调整为100%，与父容器保持一致
4. 删除了AI评分相关的所有代码和样式
