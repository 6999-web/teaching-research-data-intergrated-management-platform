# 表单与附件同步上传功能测试指南

## 测试环境准备

### 1. 启动服务
确保前端和后端服务都在运行：
- 前端：http://localhost:3000
- 后端：http://localhost:8000

### 2. 测试账号
使用教研室端测试账号登录：
- 用户名：director1
- 密码：password123

## 测试步骤

### 测试1：基本表单填写（不上传附件）

**目的**：验证不上传附件也能正常提交表单

**步骤**：
1. 登录教研室端
2. 点击"自评表填写"
3. 填写所有必填项（8个常规教学工作项）
4. 不选择考核指标，不上传附件
5. 点击"提交表单"按钮
6. 观察提交结果

**预期结果**：
- ✅ 表单验证通过
- ✅ 显示"正在提交自评表，请稍候..."
- ✅ 显示"提交成功！数据已上传到考评小组端"
- ✅ 自动跳转到教研室主页

---

### 测试2：表单填写并上传单个附件

**目的**：验证上传单个附件的功能

**步骤**：
1. 登录教研室端
2. 点击"自评表填写"
3. 填写所有必填项
4. 滚动到"附件上传"区域
5. 选择考核指标："教学改革项目"
6. 点击上传区域，选择一个PDF文件（或拖拽文件到上传区域）
7. 确认文件出现在"已选择的文件"列表中
8. 点击"提交表单并上传附件"按钮
9. 观察提交过程

**预期结果**：
- ✅ 文件成功添加到列表
- ✅ 显示文件名、大小、考核指标
- ✅ 按钮文字变为"提交表单并上传附件"
- ✅ 提交时显示"正在提交自评表，请稍候..."
- ✅ 显示"正在上传附件，请稍候..."
- ✅ 显示"1 个附件上传成功"
- ✅ 显示"正在提交到考评小组，请稍候..."
- ✅ 显示"提交成功！数据已上传到考评小组端"
- ✅ 自动跳转到教研室主页

---

### 测试3：上传多个附件（同一指标）

**目的**：验证同一指标上传多个文件

**步骤**：
1. 登录教研室端
2. 点击"自评表填写"
3. 填写所有必填项
4. 选择考核指标："荣誉表彰"
5. 上传3个文件（可以是PDF、图片等）
6. 确认所有文件都在列表中
7. 点击"提交表单并上传附件"

**预期结果**：
- ✅ 所有文件都成功添加到列表
- ✅ 每个文件都显示正确的信息
- ✅ 提交时显示"3 个附件上传成功"
- ✅ 提交成功

---

### 测试4：上传多个附件（不同指标）

**目的**：验证不同指标的文件上传

**步骤**：
1. 登录教研室端
2. 点击"自评表填写"
3. 填写所有必填项
4. 选择考核指标："教学改革项目"
5. 上传2个PDF文件
6. 切换考核指标为："课程建设"
7. 观察文件列表变化
8. 上传2个PPT文件
9. 点击"提交表单并上传附件"

**预期结果**：
- ✅ 切换指标时，之前的文件列表被清空
- ✅ 新指标的文件成功上传
- ✅ 提交时只上传当前指标的文件

**注意**：当前实现中，切换指标会清空文件列表。如果需要为多个指标上传文件，需要在提交后再次进入附件管理页面单独上传。

---

### 测试5：文件格式验证

**目的**：验证文件格式限制

**步骤**：
1. 登录教研室端
2. 点击"自评表填写"
3. 填写所有必填项
4. 选择考核指标："教学改革项目"（支持：pdf, doc, docx, jpg, jpeg, png）
5. 尝试上传一个不支持的格式（如.txt或.zip文件）
6. 观察系统反应

**预期结果**：
- ✅ 系统拒绝不支持的文件格式
- ✅ 显示错误提示
- ✅ 文件不会添加到列表

---

### 测试6：文件大小限制

**目的**：验证文件大小限制（50MB）

**步骤**：
1. 登录教研室端
2. 点击"自评表填写"
3. 填写所有必填项
4. 选择考核指标："教学改革项目"
5. 尝试上传一个超过50MB的文件
6. 观察系统反应

**预期结果**：
- ✅ 系统拒绝超大文件
- ✅ 显示"文件大小超过50MB限制"
- ✅ 文件不会添加到列表

---

### 测试7：文件数量限制

**目的**：验证最多上传10个文件的限制

**步骤**：
1. 登录教研室端
2. 点击"自评表填写"
3. 填写所有必填项
4. 选择考核指标："教学改革项目"
5. 尝试一次性选择11个文件
6. 观察系统反应

**预期结果**：
- ✅ 系统拒绝超过10个文件
- ✅ 显示"最多只能上传10个文件"的警告
- ✅ 只添加前10个文件到列表

---

### 测试8：删除已选择的文件

**目的**：验证删除文件功能

**步骤**：
1. 登录教研室端
2. 点击"自评表填写"
3. 填写所有必填项
4. 选择考核指标："教学改革项目"
5. 上传3个文件
6. 点击第2个文件的"删除"按钮
7. 观察文件列表变化
8. 提交表单

**预期结果**：
- ✅ 第2个文件从列表中移除
- ✅ 剩余2个文件
- ✅ 提交时只上传2个文件

---

### 测试9：表单验证失败

**目的**：验证表单验证与附件上传的关系

**步骤**：
1. 登录教研室端
2. 点击"自评表填写"
3. 只填写部分必填项（故意留空一些）
4. 选择考核指标并上传文件
5. 点击"提交表单并上传附件"
6. 观察系统反应

**预期结果**：
- ✅ 表单验证失败
- ✅ 显示"请填写所有必填项"
- ✅ 不会上传附件
- ✅ 不会提交表单
- ✅ 已选择的文件仍然保留在列表中

---

### 测试10：网络错误处理

**目的**：验证网络错误时的处理

**步骤**：
1. 登录教研室端
2. 点击"自评表填写"
3. 填写所有必填项
4. 选择考核指标并上传文件
5. 在提交前，停止后端服务
6. 点击"提交表单并上传附件"
7. 观察系统反应

**预期结果**：
- ✅ 显示网络错误提示
- ✅ 提交失败
- ✅ 用户可以重新尝试

---

## 测试检查清单

### 功能测试
- [ ] 不上传附件可以提交表单
- [ ] 上传单个附件可以提交
- [ ] 上传多个附件可以提交
- [ ] 切换指标时清空文件列表
- [ ] 删除文件功能正常
- [ ] 文件信息显示正确（名称、大小、指标）

### 验证测试
- [ ] 文件格式验证正确
- [ ] 文件大小限制生效（50MB）
- [ ] 文件数量限制生效（10个）
- [ ] 表单验证失败时不上传附件

### UI/UX测试
- [ ] 按钮文字根据是否有附件动态变化
- [ ] 提交时显示加载状态
- [ ] 已提交后按钮禁用
- [ ] 提示信息清晰友好
- [ ] 文件列表显示美观

### 错误处理测试
- [ ] 网络错误时正确提示
- [ ] 上传失败时正确提示
- [ ] 部分文件失败时正确提示

### 集成测试
- [ ] 表单保存成功
- [ ] 附件上传成功
- [ ] 提交并锁定成功
- [ ] AI评分自动触发
- [ ] 正确跳转到主页

## 常见问题排查

### 问题1：文件上传失败
**可能原因**：
- 后端服务未启动
- 文件存储路径不存在
- 权限不足

**解决方法**：
1. 检查后端服务是否运行
2. 检查 `backend/uploads/` 目录是否存在
3. 检查目录权限

### 问题2：提交后没有跳转
**可能原因**：
- 路由配置错误
- 提交流程中断

**解决方法**：
1. 检查浏览器控制台错误
2. 检查网络请求是否成功
3. 检查路由配置

### 问题3：附件上传成功但看不到
**可能原因**：
- 数据库未正确保存
- 附件查询接口问题

**解决方法**：
1. 检查数据库 `attachments` 表
2. 检查附件查询API
3. 检查 `backend/uploads/` 目录

## 测试报告模板

```
测试日期：____________________
测试人员：____________________
测试环境：____________________

测试结果：
✅ 通过的测试：_____ 个
❌ 失败的测试：_____ 个
⚠️  需要优化：_____ 个

详细说明：
1. ___________________________
2. ___________________________
3. ___________________________

建议：
1. ___________________________
2. ___________________________
3. ___________________________
```

## 总结

完成以上所有测试后，确认功能正常工作。如有问题，请参考常见问题排查部分，或查看详细的实现文档。
