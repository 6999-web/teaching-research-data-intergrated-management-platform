# 快速测试指南 - 提交功能

## 测试环境
- 前端: http://localhost:3000
- 后端: http://localhost:8000

## 快速测试步骤

### 方法1：使用Python测试脚本（推荐）

1. **运行测试脚本**
```bash
python test_submit_evaluation.py
```

2. **观察输出**
脚本会自动测试：
- ✅ 登录
- ✅ 保存自评表
- ✅ 提交自评表
- ⚠️  触发AI评分（可能失败，这是正常的）

3. **查看结果**
如果看到"✅ 提交成功！"，说明功能正常。

### 方法2：手动测试

#### 步骤1：清除数据
打开浏览器控制台（F12），执行：
```javascript
localStorage.clear()
location.reload()
```

#### 步骤2：登录
1. 访问 http://localhost:3000
2. 点击"教研室端"卡片
3. 输入：
   - 用户名：`office1`
   - 密码：`password123`
4. 点击"登录"

#### 步骤3：填写自评表
1. 点击"填写自评表"
2. 填写所有8个必填项：
   - 教学过程管理
   - 教学质量管理
   - 课程考核
   - 教育教学科研工作
   - 课程建设
   - 教师队伍建设
   - 科学研究与学术交流
   - 教学档案室管理与建设

每项需要：
- 内容描述（至少10个字符）
- 自评分（0-10分）

#### 步骤4：提交表单
1. 滚动到页面底部
2. 点击"提交表单"按钮
3. 观察提交过程

#### 步骤5：验证结果
查看页面右上角的消息提示：
1. ⏳ "正在提交自评表，请稍候..."
2. ⏳ "正在提交到考评小组，请稍候..."
3. ✅ "提交成功！数据已上传到考评小组端"

## 预期结果

### 成功标志
- ✅ 没有403错误
- ✅ 没有401错误
- ✅ 看到成功提示
- ✅ 控制台没有错误

### 控制台输出
应该看到类似的日志：
```
Login successful, user data: {...}
Token saved: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
AI scoring triggered successfully (或者警告信息)
```

## 如果测试失败

### 检查1：登录状态
```javascript
console.log('Token:', localStorage.getItem('token'))
console.log('User Role:', localStorage.getItem('userRole'))
```

应该看到：
- Token: 一个长字符串
- User Role: "teaching_office"

### 检查2：后端服务
```bash
netstat -ano | findstr ":8000"
```

应该看到：
```
TCP    0.0.0.0:8000           0.0.0.0:0              LISTENING
```

### 检查3：数据库连接
```bash
cd backend
python check_database.py
```

### 检查4：查看错误详情
1. 打开开发者工具（F12）
2. 切换到Network标签
3. 提交表单
4. 找到失败的请求
5. 查看Response内容

## 常见错误

### 错误1: 403 Forbidden
**解决方案**:
```javascript
localStorage.clear()
location.reload()
// 然后重新登录
```

### 错误2: 401 Unauthorized
**解决方案**:
重新登录，确保使用正确的账号密码

### 错误3: "请填写所有必填项"
**解决方案**:
确保填写了所有8个常规教学工作项目

### 错误4: "自评表已锁定"
**解决方案**:
该自评表已提交，需要创建新的或联系管理员打回

## 数据库验证

### 查看提交的数据
```sql
-- 查看最新的自评表
SELECT 
  id,
  teaching_office_id,
  evaluation_year,
  status,
  submitted_at,
  created_at
FROM self_evaluations
ORDER BY created_at DESC
LIMIT 1;
```

### 预期结果
```
status: locked
submitted_at: 2026-02-14 XX:XX:XX
```

## 测试用例

### 用例1：正常提交
1. 登录
2. 填写完整的自评表
3. 提交
4. 预期：成功

### 用例2：未登录提交
1. 清除localStorage
2. 直接访问自评表页面
3. 尝试提交
4. 预期：跳转到登录页

### 用例3：重复提交
1. 提交一次成功
2. 再次尝试提交
3. 预期：提示"自评表已锁定"

### 用例4：部分填写提交
1. 只填写部分必填项
2. 尝试提交
3. 预期：提示"请填写所有必填项"

## 性能测试

### 测试提交速度
```javascript
console.time('submit')
// 点击提交按钮
// 等待成功提示
console.timeEnd('submit')
```

预期时间：< 3秒

## 成功标志
- ✅ Python测试脚本全部通过
- ✅ 手动测试提交成功
- ✅ 数据库中状态为"locked"
- ✅ 没有控制台错误
- ✅ 操作日志已记录

## 下一步
测试成功后，可以：
1. 测试考评小组端查看提交的数据
2. 测试手动评分功能
3. 测试最终评分功能
4. 进行完整的端到端测试

## 相关文档
- `提交到考评小组问题修复.md` - 详细修复说明
- `test_submit_evaluation.py` - Python测试脚本
- `快速修复-登录和提交问题.md` - 登录问题修复
