# 教研室端角色简化说明

## 📋 更新概述

**更新时间**: 2026-02-10  
**更新内容**: 移除教研室端的二级学院负责人角色，登录后直接进入教研室端，角色名称从"教研室负责人"改为"教研室"  
**影响范围**: 
- 登录页面（Login.vue）
- 教研室端主页（TeachingOfficeHome.vue）
- 角色名称显示（auth.ts）

---

## ✨ 主要变更

### 1. 登录页面简化 ✅

#### 旧版本
- ❌ 教研室端登录需要选择角色
- ❌ 有两个角色选项：教研室负责人、二级学院负责人
- ❌ 需要额外的角色选择步骤

#### 新版本
- ✅ 教研室端登录无需选择角色
- ✅ 自动设置为教研室角色
- ✅ 简化登录流程，减少操作步骤
- ✅ 角色名称显示为"教研室"

### 2. 教研室端主页简化 ✅

#### 旧版本
- ❌ 根据角色动态显示不同菜单
- ❌ 包含教研室负责人和二级学院负责人两套配置
- ❌ 代码复杂，维护困难

#### 新版本
- ✅ 只保留教研室的菜单和功能
- ✅ 移除二级学院负责人的相关配置
- ✅ 代码简化，更易维护
- ✅ 角色徽章显示"教研室"

---

## 📁 修改文件

### 1. Login.vue
**路径**: `frontend/src/views/Login.vue`

**修改内容**:

#### 1. 更新卡片描述
```vue
<!-- 旧版本 -->
<p class="card-desc">教研室负责人、学院领导</p>

<!-- 新版本 -->
<p class="card-desc">教研室</p>
```

#### 2. 移除角色选择表单项
```vue
<!-- 旧版本 -->
<el-form-item v-if="selectedPortal === 'teaching-office'" label="角色" prop="role">
  <el-select v-model="loginForm.role" placeholder="请选择角色" style="width: 100%">
    <el-option label="教研室负责人" value="director" />
    <el-option label="二级学院负责人" value="college_leader" />
  </el-select>
</el-form-item>

<!-- 新版本 -->
<!-- 完全移除 -->
```

#### 3. 更新表单验证规则
```typescript
// 旧版本
const loginRules = {
  username: [
    { required: true, message: '请输入用户名', trigger: 'blur' }
  ],
  password: [
    { required: true, message: '请输入密码', trigger: 'blur' },
    { min: 6, message: '密码长度不能少于6位', trigger: 'blur' }
  ],
  role: [
    { required: true, message: '请选择角色', trigger: 'change' }
  ]
}

// 新版本
const loginRules = computed(() => {
  const rules: any = {
    username: [
      { required: true, message: '请输入用户名', trigger: 'blur' }
    ],
    password: [
      { required: true, message: '请输入密码', trigger: 'blur' },
      { min: 6, message: '密码长度不能少于6位', trigger: 'blur' }
    ]
  }
  
  // 只有管理端需要选择角色
  if (selectedPortal.value === 'management') {
    rules.role = [
      { required: true, message: '请选择角色', trigger: 'change' }
    ]
  }
  
  return rules
})
```

#### 4. 更新登录处理逻辑
```typescript
// 旧版本
const handleLogin = async () => {
  // ...
  authStore.userName = loginForm.value.username
  authStore.userRole = loginForm.value.role as any
  // ...
}

// 新版本
const handleLogin = async () => {
  // ...
  authStore.userName = loginForm.value.username
  
  // 教研室端直接设置为教研室角色
  if (selectedPortal.value === 'teaching-office') {
    authStore.userRole = 'director'
  } else {
    authStore.userRole = loginForm.value.role as any
  }
  // ...
}
```

### 3. Auth Store
**路径**: `frontend/src/stores/auth.ts`

**修改内容**:

#### 更新角色名称映射
```typescript
// 旧版本
roleName: (state) => {
  const roleMap = {
    director: '教研室负责人',
    college_leader: '二级学院负责人',
    academic_affairs: '学校教务处负责人',
    president_office: '校长办公会'
  }
  return roleMap[state.userRole as keyof typeof roleMap] || ''
},

// 新版本
roleName: (state) => {
  const roleMap = {
    director: '教研室',
    college_leader: '二级学院负责人',
    academic_affairs: '学校教务处负责人',
    president_office: '校长办公会'
  }
  return roleMap[state.userRole as keyof typeof roleMap] || ''
},
```

### 2. TeachingOfficeHome.vue
**路径**: `frontend/src/views/TeachingOfficeHome.vue`

**修改内容**:

#### 1. 简化表单显示逻辑
```typescript
// 旧版本
const shouldShowForm = computed(() => {
  return authStore.userRole === 'director' && (activeMenu.value === 0 || activeMenu.value === 1)
})

// 新版本
const shouldShowForm = computed(() => {
  return activeMenu.value === 0 || activeMenu.value === 1
})
```

#### 2. 简化菜单配置
```typescript
// 旧版本
const menuItems = computed(() => {
  const role = authStore.userRole
  
  if (role === 'director') {
    return [
      { name: '填写自评表', icon: EditPen },
      { name: '材料提交', icon: Upload },
      { name: '改进措施', icon: CircleCheck }
    ]
  } else if (role === 'college_leader') {
    return [
      { name: '学院驾驶舱', icon: TrendCharts },
      { name: '整改督导', icon: CircleCheck }
    ]
  }
  
  return []
})

// 新版本（注释也更新为"教研室"）
// 菜单项（只有教研室）
const menuItems = ref([
  { name: '填写自评表', icon: EditPen },
  { name: '材料提交', icon: Upload },
  { name: '改进措施', icon: CircleCheck }
])
```

#### 3. 简化标签页配置
```typescript
// 旧版本
const tabsConfig = {
  director: [
    [
      { name: '教研室工作考核评分表', icon: EditPen, description: '填写教研室工作考核评分表' }
    ],
    // ...
  ],
  college_leader: [
    [
      { name: '全院概览', icon: TrendCharts, description: '全院教研室考评概况' },
      // ...
    ],
    // ...
  ]
}

// 新版本
const tabsConfig = [
  [
    { name: '教研室工作考核评分表', icon: EditPen, description: '填写教研室工作考核评分表' }
  ],
  [
    { name: '附件列表', icon: FolderOpened, description: '查看和提交附件' }
  ],
  [
    { name: '改进措施表', icon: CircleCheck, description: '填写改进措施' }
  ]
]
```

#### 4. 简化功能配置
```typescript
// 旧版本
const functionsConfig = {
  director: [
    [], // 第一个菜单显示自评表表单
    [], // 第二个菜单显示附件管理表单
    [
      { name: '填写改进措施', description: '针对薄弱项填写改进措施', icon: EditPen, route: '/improvement-plan/1' },
      { name: '查看审核状态', description: '查看改进措施的审核状态', icon: CircleCheck, route: '/improvement-plan/1' }
    ]
  ],
  college_leader: [
    // ...
  ]
}

// 新版本
const functionsConfig = [
  [], // 第一个菜单显示自评表表单
  [], // 第二个菜单显示附件管理表单
  [
    { name: '填写改进措施', description: '针对薄弱项填写改进措施', icon: EditPen, route: '/improvement-plan/1' },
    { name: '查看审核状态', description: '查看改进措施的审核状态', icon: CircleCheck, route: '/improvement-plan/1' }
  ]
]
```

#### 5. 移除不必要的导入
```typescript
// 旧版本
import { 
  User,
  Edit,
  EditPen,
  Upload,
  View,
  ArrowRight,
  Document,
  DataAnalysis,
  CircleCheck,
  TrendCharts,
  Histogram,
  PieChart,
  FolderOpened,
  Monitor,
  SwitchButton
} from '@element-plus/icons-vue'

// 新版本
import { 
  User,
  EditPen,
  Upload,
  ArrowRight,
  CircleCheck,
  FolderOpened,
  SwitchButton
} from '@element-plus/icons-vue'
```

---

## 🎯 功能对比

### 登录流程

#### 旧版本
```
1. 选择"教研室端"
2. 输入用户名
3. 输入密码
4. 选择角色（教研室负责人 / 二级学院负责人）
5. 点击登录
6. 进入对应角色的主页
```

#### 新版本
```
1. 选择"教研室端"
2. 输入用户名
3. 输入密码
4. 点击登录
5. 自动进入教研室主页（角色显示为"教研室"）
```

**优化点**:
- ✅ 减少操作步骤（从6步减少到5步）
- ✅ 无需选择角色
- ✅ 登录更快捷

### 教研室端功能

#### 保留的功能
- ✅ 填写自评表（直接显示表单）
- ✅ 材料提交（直接显示附件管理）
- ✅ 改进措施（功能卡片）
- ✅ 角色名称显示为"教研室"

#### 移除的功能
- ❌ 学院驾驶舱（二级学院负责人功能）
- ❌ 整改督导（二级学院负责人功能）

---

## 🚀 使用指南

### 教研室端登录（新流程）

1. **访问登录页面**
   - 打开浏览器，访问 http://localhost:3000

2. **选择教研室端**
   - 点击"教研室端"卡片

3. **输入登录信息**
   - 用户名：输入您的用户名
   - 密码：输入您的密码（至少6位）

4. **点击登录**
   - 点击"登录"按钮
   - 系统自动设置为教研室角色

5. **进入主页**
   - 自动跳转到教研室主页
   - 角色徽章显示"教研室"
   - 看到三个菜单：填写自评表、材料提交、改进措施

---

## ✅ 更新完成

### 修改文件（3个）
- ✅ `frontend/src/views/Login.vue` - 移除角色选择，自动设置为教研室角色
- ✅ `frontend/src/views/TeachingOfficeHome.vue` - 移除二级学院负责人配置
- ✅ `frontend/src/stores/auth.ts` - 更新角色名称为"教研室"

### 优化内容
- ✅ 简化登录流程
- ✅ 移除角色选择步骤
- ✅ 简化代码结构
- ✅ 提高可维护性
- ✅ 角色名称更简洁（"教研室"而非"教研室负责人"）

### 测试状态
- ✅ 前端服务运行中
- ✅ 热更新已生效
- ✅ 可以立即查看效果

---

## 📝 注意事项

### 二级学院负责人功能去哪了？

二级学院负责人的功能（学院驾驶舱、整改督导）已经从教研室端移除。如果需要这些功能，可以：

1. **方案一**：在管理端添加二级学院负责人角色
2. **方案二**：创建独立的"学院端"
3. **方案三**：在 Home.vue 的四角色模式中使用

### 如何恢复二级学院负责人功能？

如果需要恢复二级学院负责人功能，可以：

1. 在 Login.vue 中恢复角色选择表单项
2. 在 TeachingOfficeHome.vue 中恢复二级学院负责人的配置
3. 更新登录处理逻辑，允许选择角色

---

## 🎨 界面展示

### 登录页面（新版本）

```
┌─────────────────────────────────────────────────────┐
│                 教研室数据管理平台                    │
├─────────────────────────────────────────────────────┤
│                                                     │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐        │
│  │ 教研室端  │  │  管理端  │  │ 数据大屏  │        │
│  │          │  │          │  │          │        │
│  │ 教研室负  │  │ 管理员、  │  │ 公开展示  │        │
│  │ 责人      │  │ 校长办公  │  │ 无需登录  │        │
│  │          │  │ 会        │  │          │        │
│  └──────────┘  └──────────┘  └──────────┘        │
│                                                     │
└─────────────────────────────────────────────────────┘
```

### 登录对话框（教研室端 - 新版本）

```
┌─────────────────────────────────┐
│      教研室端登录                │
├─────────────────────────────────┤
│                                 │
│  用户名: [________________]     │
│                                 │
│  密码:   [________________]     │
│                                 │
│  [取消]           [登录]        │
│                                 │
└─────────────────────────────────┘
```

**注意**：不再显示"角色"选择框

### 教研室端主页（新版本）

```
┌─────────────────────────────────────────────────────┐
│ 教研室端                                              │
├─────────────────────────────────────────────────────┤
│ 侧边栏          │ 主内容区                            │
│                 │                                    │
│ ✓ 填写自评表    │ [自评表表单直接显示]                │
│   材料提交      │                                    │
│   改进措施      │                                    │
│                 │                                    │
│ [教研室]        │                                    │
│ 用户名          │                                    │
└─────────────────────────────────────────────────────┘
```

**注意**：角色徽章显示"教研室"而非"教研室负责人"

---

**更新完成时间**: 2026-02-10  
**版本**: v2.0.5  
**状态**: ✅ 教研室端角色简化完成

---

© 2026 教研室数据管理平台. All rights reserved.
