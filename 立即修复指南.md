# 立即修复指南

## ✅ 已修复的问题

### 1. Vue警告问题（已修复）

**问题**：控制台显示Vue警告关于reactive对象和组件

**修复**：
- 文件：`frontend/src/views/TeachingOfficeHome.vue`
- 使用`markRaw()`包装所有图标组件
- 添加了`markRaw`导入

### 2. 考评小组端500错误

**问题**：API返回500 Internal Server Error

**可能原因**：
1. 后端服务未正常运行
2. 数据库连接问题
3. teaching_offices表中没有数据

## 🔧 立即执行的修复步骤

### 步骤1：刷新前端页面

```bash
# 在浏览器中按 Ctrl+Shift+R 强制刷新
# 或清除缓存后刷新
```

### 步骤2：修复数据库

运行修复SQL脚本：

```bash
mysql -u root -proot < fix_issues.sql
```

或手动在MySQL中执行：

```sql
USE teaching_office_evaluation;

-- 确保teaching_offices表有数据
INSERT INTO teaching_offices (id, name, code, department, created_at, updated_at)
VALUES ('test-office-001', 'Test Teaching Office', 'TEST001', 'Test Department', NOW(), NOW())
ON DUPLICATE KEY UPDATE name=name;

-- 查看数据
SELECT * FROM teaching_offices;
SELECT * FROM users WHERE username LIKE 'test_%';
```

### 步骤3：重启后端服务

```bash
# 停止当前后端服务（Ctrl+C）
# 然后重新启动
cd backend
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### 步骤4：测试功能

#### 测试教研室端：

1. 访问：http://localhost:3000/login
2. 登录：`test_teaching_office` / `password123`
3. 点击"填写自评表"
4. 填写表单并提交
5. **预期**：成功提交，无Vue警告

#### 测试考评小组端：

1. 访问：http://localhost:3000/login
2. 登录：`test_eval_team` / `password123`
3. 访问手动评分页面
4. **预期**：能够加载列表，无500错误

## 🐛 如果仍有问题

### 检查后端日志

查看后端控制台输出，找到500错误的详细信息：

```
ERROR: ...
Traceback (most recent call last):
  ...
```

### 检查数据库连接

在MySQL中执行：

```sql
-- 测试查询
SELECT 
    se.id,
    to.name as teaching_office_name,
    se.status
FROM self_evaluations se
JOIN teaching_offices to ON se.teaching_office_id = to.id
WHERE se.status IN ('locked', 'ai_scored');
```

如果这个查询失败，说明：
- teaching_offices表为空
- 或者外键关系有问题

### 检查API端点

使用浏览器或curl测试：

```bash
# 先登录获取token
curl -X POST http://localhost:8000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"test_eval_team","password":"password123","role":"evaluation_team"}'

# 使用token调用API
curl -X GET http://localhost:8000/api/scoring/evaluations-for-scoring \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

## 📋 完整的测试清单

### 前置条件
- [ ] 前端代码已更新（markRaw修复）
- [ ] 浏览器已强制刷新
- [ ] 数据库有teaching_offices数据
- [ ] 后端服务正常运行
- [ ] 测试用户已创建

### 教研室端
- [ ] 无Vue警告
- [ ] 能够填写表单
- [ ] 能够提交表单
- [ ] 显示成功消息

### 考评小组端
- [ ] 无500错误
- [ ] 能够加载列表
- [ ] 能够看到待评分的表单

## 🎯 预期结果

### 教研室端
- ✅ 控制台无Vue警告
- ✅ 表单正常显示
- ✅ 提交成功

### 考评小组端
- ✅ 无500错误
- ✅ 列表正常加载
- ✅ 显示待评分的表单

## 🚨 紧急修复命令

如果需要快速修复，按顺序执行：

```bash
# 1. 修复数据库
mysql -u root -proot < fix_issues.sql

# 2. 重启后端
cd backend
# Ctrl+C 停止当前服务
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# 3. 刷新前端
# 在浏览器中按 Ctrl+Shift+R
```

## 📞 需要更多帮助？

如果问题仍然存在，请提供：

1. **后端错误日志**（完整的错误堆栈）
2. **浏览器控制台截图**（F12 → Console）
3. **Network标签截图**（F12 → Network）
4. **数据库查询结果**：
   ```sql
   SELECT COUNT(*) FROM teaching_offices;
   SELECT COUNT(*) FROM self_evaluations WHERE status IN ('locked', 'ai_scored');
   ```

我会继续帮您解决！
