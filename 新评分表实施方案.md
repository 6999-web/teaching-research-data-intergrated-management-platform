# 新评分表实施方案

## 📋 变更概述

将现有的简化评分表改为更详细的**教研室工作考核评分表**，包含常规教学工作、特色亮点项目和负面清单三大部分。

---

## 🔄 新旧对比

### 旧版评分表（当前）
```
1. 教学过程管理（文本输入）
2. 课程建设（文本输入）
3. 教学改革项目个数（数字输入）
4. 荣誉表彰个数（数字输入）
5. 教学现象（文本输入）
6. 学生指导（文本输入）
7. 科研工作（文本输入）
8. 团队建设（文本输入）
```

### 新版评分表（目标）
```
【常规教学工作】（8项）
1. 教学过程管理
2. 教学质量管理
3. 课程考核
4. 教育教学科研工作
5. 课程建设
6. 教师队伍建设
7. 科学研究与学术交流
8. 教学档案室管理与建设

【特色与亮点项目】（4项）
9. 教学改革项目（带分值标准）
10. 年度获得教学相关荣誉表彰（带分值标准）
11. 教学比赛（带分值标准）
12. 指导创新创业比赛获奖情况（带分值标准）

【负面清单】（4项）
13. 教师中有严重违反师德师风的行为
14. 出现教学（管理）事故
15. 教学过程中出现意识形态问题
16. 教师未完成年度基本教学工作量
```

---

## 📊 新评分表结构设计

### 数据结构（JSON格式）

```json
{
  "basic_info": {
    "teaching_office_name": "软件工程教研室",
    "evaluation_year": 2024
  },
  
  "regular_teaching": {
    "teaching_process_management": {
      "description": "制定年度教研室工作计划，并采取有效措施保证计划落实...",
      "content": "教研室填写的具体内容",
      "max_score": 10,
      "self_score": 9
    },
    "teaching_quality_management": {
      "description": "了解教研室成员教学基本情况，不断改进教学...",
      "content": "教研室填写的具体内容",
      "max_score": 10,
      "self_score": 8
    },
    "course_assessment": {
      "description": "试题无错漏并符合规范，课程考核能有效检测...",
      "content": "教研室填写的具体内容",
      "max_score": 10,
      "self_score": 9
    },
    "education_research": {
      "description": "组织教师开展教学方法、教学内容、教学手段的探索与实践...",
      "content": "教研室填写的具体内容",
      "max_score": 10,
      "self_score": 8
    },
    "course_construction": {
      "description": "每门课程配备主讲教师，所有课程均有规范的教学大纲...",
      "content": "教研室填写的具体内容",
      "max_score": 10,
      "self_score": 9
    },
    "teacher_team_building": {
      "description": "制订有教师培养规划，有计划地安排青年教师的教学...",
      "content": "教研室填写的具体内容",
      "max_score": 10,
      "self_score": 8
    },
    "research_and_exchange": {
      "description": "承担有科研项目，开展有计划、有组织的社会服务活动...",
      "content": "教研室填写的具体内容",
      "max_score": 10,
      "self_score": 7
    },
    "archive_management": {
      "description": "各类教学档案齐全，教学管理档案归档及时。",
      "content": "教研室填写的具体内容",
      "max_score": 10,
      "self_score": 9
    }
  },
  
  "highlights": {
    "teaching_reform_projects": {
      "description": "教研室成员年度有新增教改项目立项",
      "scoring_rules": {
        "national_key": 10,
        "national_general": 8,
        "provincial_key": 6,
        "provincial_general_a": 4,
        "provincial_general_b": 2,
        "provincial_vocational_key": 6,
        "provincial_vocational_general": 3,
        "school_key": 2,
        "school_general": 1
      },
      "items": [
        {
          "name": "项目名称",
          "level": "provincial_key",
          "score": 6,
          "attachment_id": "uuid-xxx"
        }
      ],
      "total_score": 6
    },
    "teaching_honors": {
      "description": "年度获得教学相关荣誉表彰",
      "scoring_rules": {
        "national": 10,
        "provincial": 5,
        "school": 3
      },
      "items": [
        {
          "name": "荣誉名称",
          "level": "provincial",
          "score": 5,
          "attachment_id": "uuid-xxx"
        }
      ],
      "total_score": 5
    },
    "teaching_competitions": {
      "description": "在厅（校）级以上各类教学比赛中获奖",
      "scoring_rules": {
        "national_first": 10,
        "national_second": 8,
        "national_third": 6,
        "provincial_first": 6,
        "provincial_second": 5,
        "provincial_third": 3,
        "school_first": 3,
        "school_second": 2,
        "school_third": 1
      },
      "items": [],
      "total_score": 0
    },
    "innovation_competitions": {
      "description": "指导创新创业比赛获奖情况",
      "scoring_rules": {
        "national_gold": 10,
        "national_silver": 8,
        "national_bronze": 6,
        "provincial_gold": 6,
        "provincial_silver": 5,
        "provincial_bronze": 3,
        "school_first": 3,
        "school_second": 2,
        "school_third": 1
      },
      "items": [],
      "total_score": 0
    }
  },
  
  "negative_list": {
    "ethics_violations": {
      "description": "教师中有严重违反师德师风的行为，造成恶劣社会影响",
      "deduction_per_case": 10,
      "cases": [],
      "total_deduction": 0
    },
    "teaching_accidents": {
      "description": "出现教学（管理）事故",
      "deduction_per_case": 5,
      "cases": [],
      "total_deduction": 0
    },
    "ideology_issues": {
      "description": "教学过程中出现意识形态问题",
      "deduction_per_case": 5,
      "cases": [],
      "total_deduction": 0
    },
    "workload_incomplete": {
      "description": "教师未完成年度基本教学工作量",
      "deduction_rules": {
        "over_10_percent": 2,
        "over_20_percent": 5,
        "over_30_percent": 10
      },
      "incomplete_percentage": 0,
      "total_deduction": 0
    }
  },
  
  "summary": {
    "regular_teaching_total": 67,
    "highlights_total": 11,
    "negative_list_total": 0,
    "final_score": 78
  }
}
```

---

## 🎨 前端表单设计

### 1. 常规教学工作部分

```vue
<template>
  <el-card class="section-card">
    <template #header>
      <h3>一、常规教学工作</h3>
    </template>
    
    <el-form :model="formData.regular_teaching" label-width="150px">
      <!-- 1. 教学过程管理 -->
      <el-form-item label="教学过程管理">
        <el-input
          type="textarea"
          :rows="4"
          v-model="formData.regular_teaching.teaching_process_management.content"
          placeholder="制定年度教研室工作计划，并采取有效措施保证计划落实，各个教学环节的正常运转。落实集体备课制度，按规定选用教材，完成指导毕业生的毕业实习、毕业论文（设计）及答辩工作。"
          maxlength="1000"
          show-word-limit
        />
        <div class="score-input">
          <span>自评分：</span>
          <el-input-number
            v-model="formData.regular_teaching.teaching_process_management.self_score"
            :min="0"
            :max="10"
            :step="0.5"
          />
          <span class="max-score">/ 10分</span>
        </div>
      </el-form-item>
      
      <!-- 2. 教学质量管理 -->
      <el-form-item label="教学质量管理">
        <el-input
          type="textarea"
          :rows="4"
          v-model="formData.regular_teaching.teaching_quality_management.content"
          placeholder="了解教研室成员教学基本情况，不断改进教学。组织教师相互听课学习，开展教学评议活动积极配合学校及教学院部开展教学检查工作。"
          maxlength="1000"
          show-word-limit
        />
        <div class="score-input">
          <span>自评分：</span>
          <el-input-number
            v-model="formData.regular_teaching.teaching_quality_management.self_score"
            :min="0"
            :max="10"
            :step="0.5"
          />
          <span class="max-score">/ 10分</span>
        </div>
      </el-form-item>
      
      <!-- 其他6个指标类似... -->
    </el-form>
  </el-card>
</template>
```

### 2. 特色与亮点项目部分

```vue
<template>
  <el-card class="section-card">
    <template #header>
      <h3>二、特色与亮点项目</h3>
    </template>
    
    <!-- 教学改革项目 -->
    <div class="highlight-item">
      <h4>1. 教学改革项目</h4>
      <el-alert
        type="info"
        :closable="false"
        show-icon
      >
        <template #title>
          <div class="scoring-rules">
            <p>评分标准：</p>
            <ul>
              <li>国家级重点项目：10分 | 一般项目：8分</li>
              <li>自治区级本科教改重点项目：6分 | 一般项目A类：4分 | 一般项目B类：2分</li>
              <li>自治区级职业教改项目重点：6分 | 一般：3分</li>
              <li>校级重点项目：2分 | 一般项目：1分</li>
            </ul>
          </div>
        </template>
      </el-alert>
      
      <el-button
        type="primary"
        icon="Plus"
        @click="addReformProject"
        style="margin: 10px 0;"
      >
        添加教改项目
      </el-button>
      
      <el-table
        :data="formData.highlights.teaching_reform_projects.items"
        border
        style="margin-top: 10px;"
      >
        <el-table-column label="项目名称" prop="name" width="200">
          <template #default="{ row }">
            <el-input v-model="row.name" placeholder="请输入项目名称" />
          </template>
        </el-table-column>
        
        <el-table-column label="项目级别" width="200">
          <template #default="{ row }">
            <el-select v-model="row.level" placeholder="请选择级别">
              <el-option label="国家级重点" value="national_key" />
              <el-option label="国家级一般" value="national_general" />
              <el-option label="省级重点" value="provincial_key" />
              <el-option label="省级一般A类" value="provincial_general_a" />
              <el-option label="省级一般B类" value="provincial_general_b" />
              <el-option label="省级职教重点" value="provincial_vocational_key" />
              <el-option label="省级职教一般" value="provincial_vocational_general" />
              <el-option label="校级重点" value="school_key" />
              <el-option label="校级一般" value="school_general" />
            </el-select>
          </template>
        </el-table-column>
        
        <el-table-column label="得分" width="100">
          <template #default="{ row }">
            {{ getProjectScore(row.level) }}分
          </template>
        </el-table-column>
        
        <el-table-column label="支撑材料" width="150">
          <template #default="{ row }">
            <el-button
              type="primary"
              size="small"
              @click="uploadAttachment(row)"
            >
              上传附件
            </el-button>
          </template>
        </el-table-column>
        
        <el-table-column label="操作" width="100">
          <template #default="{ $index }">
            <el-button
              type="danger"
              size="small"
              @click="removeProject($index)"
            >
              删除
            </el-button>
          </template>
        </el-table-column>
      </el-table>
      
      <div class="total-score">
        总分：{{ calculateReformProjectsTotal() }}分
      </div>
    </div>
    
    <!-- 其他3个亮点项目类似... -->
  </el-card>
</template>
```

### 3. 负面清单部分

```vue
<template>
  <el-card class="section-card negative-list">
    <template #header>
      <h3>三、负面清单</h3>
    </template>
    
    <el-alert
      type="warning"
      :closable="false"
      show-icon
      style="margin-bottom: 20px;"
    >
      以下情况将扣分，请如实填写
    </el-alert>
    
    <!-- 1. 师德师风违规 -->
    <div class="negative-item">
      <h4>1. 教师中有严重违反师德师风的行为</h4>
      <p class="deduction-rule">每人/次减10分</p>
      
      <el-input-number
        v-model="formData.negative_list.ethics_violations.cases.length"
        :min="0"
        :max="10"
        @change="updateEthicsViolations"
      />
      <span style="margin-left: 10px;">起</span>
      
      <div class="deduction-total">
        扣分：{{ formData.negative_list.ethics_violations.total_deduction }}分
      </div>
    </div>
    
    <!-- 2. 教学事故 -->
    <div class="negative-item">
      <h4>2. 出现教学（管理）事故</h4>
      <p class="deduction-rule">严重教学（管理）事故每人/次减5分</p>
      
      <el-input-number
        v-model="formData.negative_list.teaching_accidents.cases.length"
        :min="0"
        :max="10"
        @change="updateTeachingAccidents"
      />
      <span style="margin-left: 10px;">起</span>
      
      <div class="deduction-total">
        扣分：{{ formData.negative_list.teaching_accidents.total_deduction }}分
      </div>
    </div>
    
    <!-- 3. 意识形态问题 -->
    <div class="negative-item">
      <h4>3. 教学过程中出现意识形态问题</h4>
      <p class="deduction-rule">
        从事传教活动；传播错误思想观点；发表同中央精神相违背的言论；
        非议党的理论和路线方针政策及重大决策部署；散布传播政治谣言等等。
        每人/次减5分。
      </p>
      
      <el-input-number
        v-model="formData.negative_list.ideology_issues.cases.length"
        :min="0"
        :max="10"
        @change="updateIdeologyIssues"
      />
      <span style="margin-left: 10px;">起</span>
      
      <div class="deduction-total">
        扣分：{{ formData.negative_list.ideology_issues.total_deduction }}分
      </div>
    </div>
    
    <!-- 4. 工作量未完成 -->
    <div class="negative-item">
      <h4>4. 教师未完成年度基本教学工作量</h4>
      <p class="deduction-rule">
        专任教师中未完成年度教学基本工作量人数占比超过10%的减2分，
        超20%的减5分，超30%减10分。
      </p>
      
      <el-input-number
        v-model="formData.negative_list.workload_incomplete.incomplete_percentage"
        :min="0"
        :max="100"
        :step="1"
        @change="updateWorkloadDeduction"
      />
      <span style="margin-left: 10px;">%</span>
      
      <div class="deduction-total">
        扣分：{{ formData.negative_list.workload_incomplete.total_deduction }}分
      </div>
    </div>
    
    <el-divider />
    
    <div class="negative-total">
      负面清单总扣分：{{ calculateNegativeTotal() }}分
    </div>
  </el-card>
</template>
```

### 4. 总分汇总

```vue
<template>
  <el-card class="summary-card">
    <template #header>
      <h3>评分汇总</h3>
    </template>
    
    <el-descriptions :column="2" border>
      <el-descriptions-item label="常规教学工作总分">
        {{ formData.summary.regular_teaching_total }}分
      </el-descriptions-item>
      
      <el-descriptions-item label="特色与亮点项目总分">
        {{ formData.summary.highlights_total }}分
      </el-descriptions-item>
      
      <el-descriptions-item label="负面清单扣分">
        -{{ formData.summary.negative_list_total }}分
      </el-descriptions-item>
      
      <el-descriptions-item label="最终得分">
        <span class="final-score">
          {{ formData.summary.final_score }}分
        </span>
      </el-descriptions-item>
    </el-descriptions>
    
    <div class="action-buttons">
      <el-button @click="saveDraft">保存草稿</el-button>
      <el-button type="primary" @click="submitEvaluation">提交自评</el-button>
    </div>
  </el-card>
</template>

<style scoped>
.final-score {
  font-size: 24px;
  font-weight: bold;
  color: #409EFF;
}
</style>
```

---

## 🔧 后端数据模型调整

### 1. 更新 SelfEvaluation 模型

`content` 字段的JSON结构需要支持新的评分表格式：

```python
# backend/app/models/self_evaluation.py

# content字段的JSON结构示例
{
    "basic_info": {...},
    "regular_teaching": {...},  # 8个常规指标
    "highlights": {...},         # 4个亮点项目
    "negative_list": {...},      # 4个负面清单
    "summary": {...}             # 汇总信息
}
```

### 2. 更新 AI评分服务

需要修改 `ai_scoring_service.py` 中的提示词构建逻辑：

```python
def _build_scoring_prompt(self, evaluation: SelfEvaluation, attachments: List[Attachment]) -> str:
    content = evaluation.content
    
    prompt = f"""你是教研室工作考评专家，请根据以下自评表内容和附件信息进行评分。

【常规教学工作】（满分80分）
1. 教学过程管理（满分10分）：{content['regular_teaching']['teaching_process_management']['content']}
   自评分：{content['regular_teaching']['teaching_process_management']['self_score']}分

2. 教学质量管理（满分10分）：{content['regular_teaching']['teaching_quality_management']['content']}
   自评分：{content['regular_teaching']['teaching_quality_management']['self_score']}分

... (其他6个指标)

【特色与亮点项目】
1. 教学改革项目：
   {self._format_reform_projects(content['highlights']['teaching_reform_projects'])}

2. 教学相关荣誉表彰：
   {self._format_honors(content['highlights']['teaching_honors'])}

... (其他2个亮点项目)

【负面清单】
1. 师德师风违规：{content['negative_list']['ethics_violations']['cases']}起
2. 教学事故：{content['negative_list']['teaching_accidents']['cases']}起
3. 意识形态问题：{content['negative_list']['ideology_issues']['cases']}起
4. 工作量未完成比例：{content['negative_list']['workload_incomplete']['incomplete_percentage']}%

【附件信息】
{self._format_attachments(attachments)}

请按照评分标准进行评分，并返回JSON格式的结果。
"""
    
    return prompt
```

---

## 📝 实施步骤

### 阶段1：数据库和后端（1-2天）

1. ✅ 确认 `self_evaluations.content` 字段支持新的JSON结构（已支持）
2. ⏳ 更新 AI评分服务的提示词构建逻辑
3. ⏳ 更新 AI评分的解析逻辑
4. ⏳ 更新相关API接口的验证逻辑

### 阶段2：前端表单（2-3天）

1. ⏳ 创建新的自评表单组件
2. ⏳ 实现常规教学工作部分（8个指标）
3. ⏳ 实现特色与亮点项目部分（4个指标）
4. ⏳ 实现负面清单部分（4个指标）
5. ⏳ 实现总分自动计算
6. ⏳ 实现表单验证
7. ⏳ 实现保存草稿和提交功能

### 阶段3：测试和优化（1-2天）

1. ⏳ 单元测试
2. ⏳ 集成测试
3. ⏳ 用户体验优化
4. ⏳ 性能优化

---

## 🎯 关键技术点

### 1. 动态评分计算

```javascript
// 计算教改项目总分
function calculateReformProjectsTotal() {
  const scoringRules = {
    national_key: 10,
    national_general: 8,
    provincial_key: 6,
    // ... 其他规则
  };
  
  return formData.highlights.teaching_reform_projects.items.reduce(
    (total, item) => total + (scoringRules[item.level] || 0),
    0
  );
}

// 计算负面清单扣分
function calculateNegativeTotal() {
  let total = 0;
  
  // 师德师风违规
  total += formData.negative_list.ethics_violations.cases.length * 10;
  
  // 教学事故
  total += formData.negative_list.teaching_accidents.cases.length * 5;
  
  // 意识形态问题
  total += formData.negative_list.ideology_issues.cases.length * 5;
  
  // 工作量未完成
  const percentage = formData.negative_list.workload_incomplete.incomplete_percentage;
  if (percentage > 30) total += 10;
  else if (percentage > 20) total += 5;
  else if (percentage > 10) total += 2;
  
  return total;
}

// 计算最终得分
function calculateFinalScore() {
  const regularTotal = calculateRegularTeachingTotal();
  const highlightsTotal = calculateHighlightsTotal();
  const negativeTotal = calculateNegativeTotal();
  
  return regularTotal + highlightsTotal - negativeTotal;
}
```

### 2. 表单验证

```javascript
const rules = {
  // 常规教学工作必填
  'regular_teaching.teaching_process_management.content': [
    { required: true, message: '请填写教学过程管理内容', trigger: 'blur' }
  ],
  
  // 亮点项目需要附件支撑
  'highlights.teaching_reform_projects.items': [
    {
      validator: (rule, value, callback) => {
        const hasItemWithoutAttachment = value.some(item => !item.attachment_id);
        if (hasItemWithoutAttachment) {
          callback(new Error('每个教改项目都需要上传支撑材料'));
        } else {
          callback();
        }
      },
      trigger: 'change'
    }
  ]
};
```

---

## 💡 优化建议

### 1. 用户体验优化

- 添加进度保存提示
- 实现自动保存草稿（每30秒）
- 添加填写进度指示器
- 提供填写指南和示例

### 2. 数据验证

- 前端实时验证
- 后端二次验证
- 附件与项目的关联验证
- 分数合理性验证

### 3. 性能优化

- 大表单分页加载
- 附件上传进度显示
- 防抖和节流
- 懒加载非关键内容

---

## 📋 需要确认的问题

1. **常规教学工作的满分**：每项是10分吗？总分80分？
2. **特色亮点项目是否有上限**：比如教改项目最多计算几个？
3. **负面清单是否需要详细说明**：比如具体的违规事件描述？
4. **历史数据迁移**：旧版评分表的数据如何处理？

---

## 🚀 开始实施

准备好后，我可以帮你：
1. 修改后端AI评分服务
2. 创建新的前端表单组件
3. 更新相关API接口
4. 编写测试用例

请确认是否开始实施，以及是否有任何调整需求！
