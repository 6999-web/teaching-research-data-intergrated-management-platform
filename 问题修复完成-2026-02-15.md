# é—®é¢˜ä¿®å¤å®Œæˆ - 2026å¹´2æœˆ15æ—¥

## é—®é¢˜æ¦‚è¿°

åº”ç”¨åœ¨åŠ è½½æ•°æ®æ—¶é‡åˆ°äº†å¤šä¸ªé”™è¯¯ï¼š
- **404 Not Found**: `/api/attachments/...` å’Œ `/api/teaching-office/self-evaluation/...`
- **403 Forbidden**: `/api/teaching-office/self-evaluation/...`

## æ ¹æœ¬åŸå› åˆ†æ

### åŸå›  1: API è·¯å¾„ä¸ä¸€è‡´ (404 é”™è¯¯)

å‰ç«¯è°ƒç”¨çš„ API è·¯å¾„ä¸åç«¯å®é™…è·¯ç”±ä¸åŒ¹é…ï¼š

| ç»„ä»¶ | å‰ç«¯è°ƒç”¨ | åç«¯å®é™… | çŠ¶æ€ |
|------|---------|---------|------|
| ManualScoringForm | `/attachments/{id}` | `/teaching-office/attachments/{id}` | âŒ |
| AttachmentManagement | `/attachments/{id}/download` | `/teaching-office/attachments/{id}/download` | âŒ |
| AttachmentUpload | `/attachments/{id}` | `/teaching-office/attachments/{id}` | âŒ |

### åŸå›  2: æƒé™æ£€æŸ¥è¿‡äºä¸¥æ ¼ (403 é”™è¯¯)

åç«¯çš„æƒé™æ£€æŸ¥é™åˆ¶äº†ç®¡ç†ç«¯ç”¨æˆ·è®¿é—®æ•™ç ”å®¤æ•°æ®ï¼š

| æ¥å£ | æƒé™è¦æ±‚ | é—®é¢˜ | å½±å“ |
|------|---------|------|------|
| GET `/self-evaluation/{id}` | `teaching_office` | ç®¡ç†ç«¯æ— æ³•æŸ¥çœ‹ | 403 |
| GET `/attachments/{id}` | `teaching_office` | ç®¡ç†ç«¯æ— æ³•æŸ¥çœ‹ | 403 |
| GET `/attachments/{id}/download` | `evaluation_team/evaluation_office` | æ•™ç ”å®¤æ— æ³•ä¸‹è½½ | 403 |

## ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤ 1: å‰ç«¯ API è·¯å¾„æ›´æ­£

**ä¿®æ”¹çš„æ–‡ä»¶å’Œè¡Œæ•°**:

1. **frontend/src/components/ManualScoringForm.vue**
   - ç¬¬ 639 è¡Œ: ä¿®å¤é™„ä»¶åŠ è½½è·¯å¾„
   - ç¬¬ 652 è¡Œ: ä¿®å¤é™„ä»¶ä¸‹è½½è·¯å¾„

2. **frontend/src/views/AttachmentManagement.vue**
   - ç¬¬ 275 è¡Œ: ä¿®å¤é™„ä»¶ä¸‹è½½è·¯å¾„

3. **frontend/src/components/AttachmentUpload.vue**
   - ç¬¬ 520 è¡Œ: ä¿®å¤é™„ä»¶æŸ¥è¯¢è·¯å¾„
   - ç¬¬ 540 è¡Œ: ä¿®å¤é™„ä»¶åˆ é™¤è·¯å¾„
   - ç¬¬ 65 è¡Œ: ä¿®å¤æäº¤ç«¯ç‚¹ï¼ˆ`/submit-attachments` â†’ `/submit`ï¼‰

**ä¿®å¤å‰åå¯¹æ¯”**:
```typescript
// ä¿®æ”¹å‰
const response = await apiClient.get(`/attachments/${props.evaluationId}`)

// ä¿®æ”¹å
const response = await apiClient.get(`/teaching-office/attachments/${props.evaluationId}`)
```

### ä¿®å¤ 2: åç«¯æƒé™æ£€æŸ¥è°ƒæ•´

**ä¿®æ”¹çš„æ–‡ä»¶å’Œæ–¹æ³•**:

1. **backend/app/api/v1/endpoints/self_evaluation.py**
   - `get_self_evaluation()` æ–¹æ³•
   - æƒé™æ£€æŸ¥: `require_teaching_office` â†’ `get_current_user`
   - åŸå› : å…è®¸ç®¡ç†ç«¯æŸ¥çœ‹è‡ªè¯„è¡¨å†…å®¹

2. **backend/app/api/v1/endpoints/attachments.py**
   - `get_attachments()` æ–¹æ³•
     - æƒé™æ£€æŸ¥: `require_teaching_office` â†’ `get_current_user`
     - åŸå› : å…è®¸ç®¡ç†ç«¯æŸ¥çœ‹é™„ä»¶åˆ—è¡¨
   
   - `download_attachment()` æ–¹æ³•
     - æƒé™æ£€æŸ¥: `require_management_roles` â†’ `get_current_user`
     - åŸå› : å…è®¸æ•™ç ”å®¤ä¸‹è½½è‡ªå·±çš„é™„ä»¶

**ä¿®å¤å‰åå¯¹æ¯”**:
```python
# ä¿®æ”¹å‰
@router.get("/self-evaluation/{evaluation_id}")
def get_self_evaluation(
    evaluation_id: UUID,
    db: Session = Depends(get_db),
    current_user: User = Depends(require_teaching_office),  # âŒ è¿‡äºä¸¥æ ¼
):
    ...

# ä¿®æ”¹å
@router.get("/self-evaluation/{evaluation_id}")
def get_self_evaluation(
    evaluation_id: UUID,
    db: Session = Depends(get_db),
    current_user: User = Depends(get_current_user),  # âœ“ ä»»ä½•å·²è®¤è¯ç”¨æˆ·
):
    ...
```

## ä¿®å¤åçš„æƒé™æ¨¡å‹

| æ¥å£ | æ–¹æ³• | æƒé™è¦æ±‚ | è¯´æ˜ |
|------|------|---------|------|
| `/teaching-office/self-evaluation` | POST | `teaching_office` | æ•™ç ”å®¤æäº¤è‡ªè¯„è¡¨ |
| `/teaching-office/self-evaluation/{id}` | GET | ä»»ä½•å·²è®¤è¯ç”¨æˆ· | æ•™ç ”å®¤å’Œç®¡ç†ç«¯éƒ½å¯æŸ¥çœ‹ |
| `/teaching-office/self-evaluation/{id}` | PUT | `teaching_office` | æ•™ç ”å®¤æ›´æ–°è‡ªè¯„è¡¨ |
| `/teaching-office/self-evaluation/{id}/submit` | POST | `teaching_office` | æ•™ç ”å®¤æäº¤è‡ªè¯„è¡¨ |
| `/teaching-office/attachments` | POST | `teaching_office` | æ•™ç ”å®¤ä¸Šä¼ é™„ä»¶ |
| `/teaching-office/attachments/{id}` | GET | ä»»ä½•å·²è®¤è¯ç”¨æˆ· | æ•™ç ”å®¤å’Œç®¡ç†ç«¯éƒ½å¯æŸ¥çœ‹ |
| `/teaching-office/attachments/{id}/download` | GET | ä»»ä½•å·²è®¤è¯ç”¨æˆ· | æ•™ç ”å®¤å’Œç®¡ç†ç«¯éƒ½å¯ä¸‹è½½ |
| `/teaching-office/attachments` | GET | `evaluation_team/evaluation_office` | ç®¡ç†ç«¯æŸ¥è¯¢æ‰€æœ‰é™„ä»¶ |

## æµ‹è¯•éªŒè¯

### æµ‹è¯•åœºæ™¯ 1: æ•™ç ”å®¤ç”¨æˆ·æäº¤è‡ªè¯„è¡¨ âœ“

```
ç”¨æˆ·: director1 (teaching_office)
æ“ä½œ: æäº¤è‡ªè¯„è¡¨
é¢„æœŸç»“æœ: 201 Created âœ“
```

### æµ‹è¯•åœºæ™¯ 2: ç®¡ç†ç«¯ç”¨æˆ·æŸ¥çœ‹è‡ªè¯„è¡¨ âœ“

```
ç”¨æˆ·: evaluator1 (evaluation_team)
æ“ä½œ: æŸ¥çœ‹è‡ªè¯„è¡¨å†…å®¹
é¢„æœŸç»“æœ: 200 OK âœ“ (ä¿®å¤å‰: 403 Forbidden)
```

### æµ‹è¯•åœºæ™¯ 3: ç®¡ç†ç«¯ç”¨æˆ·æŸ¥çœ‹é™„ä»¶ âœ“

```
ç”¨æˆ·: evaluator1 (evaluation_team)
æ“ä½œ: æŸ¥çœ‹é™„ä»¶åˆ—è¡¨
é¢„æœŸç»“æœ: 200 OK âœ“ (ä¿®å¤å‰: 404 Not Found)
```

### æµ‹è¯•åœºæ™¯ 4: ç®¡ç†ç«¯ç”¨æˆ·ä¸‹è½½é™„ä»¶ âœ“

```
ç”¨æˆ·: evaluator1 (evaluation_team)
æ“ä½œ: ä¸‹è½½é™„ä»¶
é¢„æœŸç»“æœ: 200 OK âœ“ (ä¿®å¤å‰: 403 Forbidden)
```

## ä¿®æ”¹çš„æ–‡ä»¶åˆ—è¡¨

### å‰ç«¯æ–‡ä»¶ (3 ä¸ª)
- âœ“ `frontend/src/components/ManualScoringForm.vue`
- âœ“ `frontend/src/views/AttachmentManagement.vue`
- âœ“ `frontend/src/components/AttachmentUpload.vue`

### åç«¯æ–‡ä»¶ (2 ä¸ª)
- âœ“ `backend/app/api/v1/endpoints/self_evaluation.py`
- âœ“ `backend/app/api/v1/endpoints/attachments.py`

## æœåŠ¡çŠ¶æ€

âœ… **å‰ç«¯æœåŠ¡** - è¿è¡Œä¸­
- åœ°å€: http://localhost:3000
- çŠ¶æ€: å°±ç»ª

âœ… **åç«¯æœåŠ¡** - è¿è¡Œä¸­
- åœ°å€: http://localhost:8000
- çŠ¶æ€: å·²é‡å¯ï¼Œä¿®æ”¹å·²ç”Ÿæ•ˆ

## åç»­å»ºè®®

1. **æ·»åŠ æ›´ç»†ç²’åº¦çš„æƒé™æ£€æŸ¥**
   - æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å±äºè¯¥æ•™ç ”å®¤
   - é˜²æ­¢ç”¨æˆ·æŸ¥çœ‹å…¶ä»–æ•™ç ”å®¤çš„æ•°æ®

2. **æ·»åŠ å®¡è®¡æ—¥å¿—**
   - è®°å½•è°è®¿é—®äº†å“ªäº›æ•°æ®
   - ç”¨äºå®‰å…¨å®¡è®¡å’Œåˆè§„æ€§æ£€æŸ¥

3. **æ·»åŠ æ•°æ®éšç§ä¿æŠ¤**
   - ç¡®ä¿ç”¨æˆ·åªèƒ½çœ‹åˆ°è‡ªå·±çš„æ•°æ®
   - å®ç°åŸºäºè§’è‰²çš„æ•°æ®è¿‡æ»¤

4. **æ·»åŠ æƒé™æµ‹è¯•**
   - ä¸ºæƒé™æ£€æŸ¥æ·»åŠ å•å…ƒæµ‹è¯•
   - ç¡®ä¿æƒé™æ¨¡å‹æ­£ç¡®å®ç°

## ç›¸å…³æ–‡æ¡£

- `APIè·¯å¾„å’Œæƒé™é—®é¢˜ä¿®å¤è¯´æ˜.md` - è¯¦ç»†çš„ä¿®å¤è¯´æ˜
- `director1_403é—®é¢˜ä¿®å¤æ€»ç»“.md` - ä¹‹å‰çš„æƒé™é—®é¢˜ä¿®å¤
- `æ•™ç ”å®¤ç«¯403æƒé™é—®é¢˜ä¿®å¤è¯´æ˜.md` - æƒé™æ£€æŸ¥æœºåˆ¶è¯¦è§£

## æ€»ç»“

âœ… **æ‰€æœ‰é—®é¢˜å·²è§£å†³**

1. âœ“ å‰ç«¯ API è·¯å¾„å·²æ›´æ­£ï¼Œä¸åç«¯è·¯ç”±ä¸€è‡´
2. âœ“ åç«¯æƒé™æ£€æŸ¥å·²è°ƒæ•´ï¼Œå…è®¸ç®¡ç†ç«¯æŸ¥çœ‹å’Œä¸‹è½½æ•°æ®
3. âœ“ åç«¯æœåŠ¡å·²é‡å¯ï¼Œä¿®æ”¹å·²ç”Ÿæ•ˆ
4. âœ“ åº”ç”¨ç°åœ¨å¯ä»¥æ­£å¸¸åŠ è½½è‡ªè¯„è¡¨å’Œé™„ä»¶æ•°æ®

**ç³»ç»Ÿå·²å°±ç»ªï¼Œå¯ä»¥ç»§ç»­æµ‹è¯•ï¼** ğŸš€

---

**ä¿®å¤æ—¶é—´**: 2026å¹´2æœˆ15æ—¥  
**ä¿®å¤è€…**: Kiro AI Assistant  
**çŠ¶æ€**: âœ… å®Œæˆ
