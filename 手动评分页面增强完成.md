# 手动评分页面增强完成

## 完成时间
2026-02-13

## 修改内容

### 1. 增强的手动评分组件 (`frontend/src/components/ManualScoringForm.vue`)

#### 新增功能
1. **标签页导航** - 将手动评分页面分为4个标签页：
   - 自评表内容
   - 附件材料
   - AI评分
   - 手动评分

2. **自评表内容标签页**
   - 显示教研室填写的完整自评表内容
   - 按章节分组显示（一、二、三、四、五）
   - 显示每个项目的自评分数
   - 显示填写的具体内容

3. **附件材料标签页**
   - 以表格形式展示所有上传的附件
   - 显示考核指标、文件名、文件大小、上传时间
   - 提供下载功能
   - 显示附件总数

4. **AI评分标签页**
   - 显示AI自动评分的总分
   - 显示评分时间和解析统计
   - 显示各指标的详细评分和评分理由
   - 美观的渐变色卡片设计

5. **手动评分标签页**
   - 保留原有的手动评分功能
   - 评分表单
   - 查看所有评审人打分

#### 新增状态变量
```typescript
const activeTab = ref('content')  // 当前激活的标签页
const contentLoading = ref(false)  // 自评表内容加载状态
const selfEvaluationContent = ref<any>(null)  // 自评表内容数据
const attachmentsLoading = ref(false)  // 附件加载状态
const attachments = ref<any[]>([])  // 附件列表
const aiScoreLoading = ref(false)  // AI评分加载状态
const aiScore = ref<any>(null)  // AI评分数据
```

#### 新增方法
1. `loadSelfEvaluation()` - 加载自评表内容
2. `loadAttachments()` - 加载附件列表
3. `loadAIScore()` - 加载AI评分结果
4. `handleDownloadAttachment(attachment)` - 下载附件
5. `getSectionTitle(sectionKey)` - 获取章节标题
6. `getItemLabel(itemKey)` - 获取项目标签
7. `formatFileSize(bytes)` - 格式化文件大小
8. `formatDateTime(dateStr)` - 格式化日期时间

#### 数据加载
- 在组件挂载时并行加载所有数据：
  ```typescript
  onMounted(async () => {
    await Promise.all([
      loadSelfEvaluation(),
      loadAttachments(),
      loadAIScore()
    ])
  })
  ```

### 2. 样式增强
- 添加了标签页样式
- 添加了内容卡片样式
- 添加了附件表格样式
- 添加了AI评分卡片样式（渐变色背景）
- 优化了整体布局和间距

## 使用说明

### 考评小组/考评办公室使用流程
1. 进入"手动评分"页面
2. 选择要评分的教研室
3. 查看4个标签页的内容：
   - **自评表内容** - 了解教研室的自评情况
   - **附件材料** - 查看和下载支撑材料
   - **AI评分** - 参考AI的评分结果
   - **手动评分** - 进行人工评分

### 评分参考
- 评审人可以先查看自评表内容、附件和AI评分
- 综合考虑后在"手动评分"标签页进行打分
- 填写评语说明评分理由

## 技术实现

### API调用
1. 自评表内容：`selfEvaluationApi.get(evaluationId)`
2. 附件列表：`apiClient.get(/attachments/${evaluationId})`
3. AI评分：`scoringApi.getAllScores(evaluationId)` 
4. 附件下载：`apiClient.get(/attachments/${attachmentId}/download)`

### 数据格式
- 自评表内容：JSON格式，包含多个section，每个section包含多个item
- 附件列表：数组，每个附件包含indicator、fileName、fileSize、uploadedAt等字段
- AI评分：包含total_score、indicator_scores、parsed_reform_projects等字段

## 测试建议

1. **自评表内容显示**
   - 检查是否正确显示所有章节
   - 检查自评分是否正确显示
   - 检查内容格式是否正确

2. **附件材料**
   - 检查附件列表是否完整
   - 测试附件下载功能
   - 检查文件大小和时间格式

3. **AI评分**
   - 检查总分显示
   - 检查各指标评分详情
   - 检查评分理由显示

4. **手动评分**
   - 确保原有功能正常
   - 测试评分提交
   - 测试查看所有评审人打分

## 注意事项

1. 所有数据在组件挂载时并行加载，提高加载速度
2. 如果某个数据加载失败，会显示错误提示，但不影响其他标签页
3. 附件下载使用blob方式，支持各种文件类型
4. 评语字段为必填，长度5-500字符

## 下一步优化建议

1. 添加加载骨架屏，提升用户体验
2. 支持附件预览（图片、PDF等）
3. 添加自评表内容的搜索和筛选功能
4. 支持导出评分报告
5. 添加评分历史记录对比功能
