# å‰åç«¯å…³é”®æ–‡ä»¶å¯¼è§ˆ

**å¯¼è§ˆæ—¥æœŸ**: 2026-02-15  
**é¡¹ç›®**: æ•™ç ”å®¤æ•°æ®ç®¡ç†å¹³å°  

---

## ğŸ“ åç«¯å…³é”®æ–‡ä»¶

### 1. åç«¯å…¥å£ - `backend/app/main.py`

**ä½œç”¨**: FastAPI åº”ç”¨ä¸»å…¥å£

**å…³é”®åŠŸèƒ½**:
- åˆ›å»º FastAPI åº”ç”¨
- é…ç½® CORS ä¸­é—´ä»¶
- æ·»åŠ ç”¨æˆ·ä¿¡æ¯ä¸­é—´ä»¶
- æ·»åŠ æ“ä½œæ—¥å¿—ä¸­é—´ä»¶
- æ³¨å†Œ API è·¯ç”±

**ä»£ç ç‰‡æ®µ**:
```python
app = FastAPI(
    title=settings.PROJECT_NAME,
    openapi_url=f"{settings.API_V1_STR}/openapi.json"
)

app.add_middleware(
    CORSMiddleware,
    allow_origins=settings.BACKEND_CORS_ORIGINS,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

---

### 2. å®‰å…¨é…ç½® - `backend/app/core/security.py`

**ä½œç”¨**: å¯†ç åŠ å¯†å’Œ JWT ä»¤ç‰Œç®¡ç†

**å…³é”®ä¼˜åŒ–** (2026-02-15):
- âœ… bcrypt cost factor: **8** (æœ€å¿«çš„å®‰å…¨çº§åˆ«)
- å¯†ç éªŒè¯æ—¶é—´: 50-100ms (åŸæ¥ 200-500ms)
- æ€§èƒ½æå‡: â†“ 60-70%

**ä»£ç ç‰‡æ®µ**:
```python
pwd_context = CryptContext(
    schemes=["bcrypt"],
    deprecated="auto",
    bcrypt__rounds=8  # Ultra-optimized for performance
)
```

**ä¸»è¦å‡½æ•°**:
- `verify_password()` - éªŒè¯å¯†ç 
- `get_password_hash()` - ç”Ÿæˆå¯†ç å“ˆå¸Œ
- `create_access_token()` - åˆ›å»º JWT ä»¤ç‰Œ
- `decode_access_token()` - è§£ç  JWT ä»¤ç‰Œ

---

### 3. ç™»å½•ç«¯ç‚¹ - `backend/app/api/v1/endpoints/auth.py`

**ä½œç”¨**: ç”¨æˆ·è®¤è¯å’Œç™»å½•

**å…³é”®ä¼˜åŒ–** (2026-02-15):
- âœ… æ·»åŠ æ€§èƒ½æ—¥å¿—
- âœ… åˆ†æ­¥éª¤è®¡æ—¶
- âœ… æ€»è€—æ—¶: 60-130ms (åŸæ¥ 107-227ms)

**ç™»å½•æµç¨‹**:
1. æŸ¥è¯¢ç”¨æˆ· (5-20ms)
2. éªŒè¯å¯†ç  (50-100ms) â† ä¼˜åŒ–ç‚¹
3. è§’è‰²éªŒè¯ (< 1ms)
4. ç”Ÿæˆ JWT (1-5ms)
5. å‡†å¤‡å“åº” (< 1ms)

**æ—¥å¿—è¾“å‡ºç¤ºä¾‹**:
```
LOGIN DURATION BREAKDOWN:
  - DB Query: 8.50ms
  - Password Verify: 60.15ms (bcrypt cost 8 - optimized)
  - Role Validation: 0.10ms
  - JWT Generation: 2.50ms
  - Response Prep: 0.20ms
  - TOTAL: 71.45ms
```

---

## ğŸ“ å‰ç«¯å…³é”®æ–‡ä»¶

### 1. å‰ç«¯å…¥å£ - `frontend/src/main.ts`

**ä½œç”¨**: Vue åº”ç”¨ä¸»å…¥å£

**å…³é”®é…ç½®**:
- åˆ›å»º Vue åº”ç”¨
- é…ç½® Pinia çŠ¶æ€ç®¡ç†
- é…ç½® Vue Router è·¯ç”±
- é…ç½® Element Plus UI åº“

**ä»£ç ç‰‡æ®µ**:
```typescript
const app = createApp(App)

app.use(createPinia())
app.use(router)
app.use(ElementPlus)

app.mount('#app')
```

---

### 2. ä¸»åº”ç”¨ç»„ä»¶ - `frontend/src/App.vue`

**ä½œç”¨**: åº”ç”¨æ ¹ç»„ä»¶

**åŠŸèƒ½**:
- è·¯ç”±è§†å›¾å®¹å™¨
- å…¨å±€æ ·å¼å®šä¹‰
- è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼
- Element Plus ç»„ä»¶æ ·å¼å®šåˆ¶

---

### 3. ç™»å½•é¡µé¢ - `frontend/src/views/Login.vue`

**ä½œç”¨**: ç”¨æˆ·ç™»å½•ç•Œé¢

**åŠŸèƒ½**:
- æ˜¾ç¤ºä¸‰ä¸ªå…¥å£å¡ç‰‡:
  - æ•™ç ”å®¤ç«¯
  - ç®¡ç†ç«¯
  - æ•°æ®å¤§å±
- ç¾åŒ–çš„ç™»å½•å¯¹è¯æ¡†
- å“åº”å¼è®¾è®¡

**å…³é”®ç‰¹æ€§**:
- èƒŒæ™¯è£…é¥°åŠ¨ç”»
- å¡ç‰‡æ‚¬åœæ•ˆæœ
- å¹³æ»‘è¿‡æ¸¡åŠ¨ç”»

---

### 4. API å®¢æˆ·ç«¯ - `frontend/src/api/client.ts`

**ä½œç”¨**: ä¸åç«¯é€šä¿¡çš„ HTTP å®¢æˆ·ç«¯

**å…³é”®åŠŸèƒ½**:
- åˆ›å»º axios å®ä¾‹
- è‡ªåŠ¨æ·»åŠ  Authorization å¤´
- å¤„ç† 401 æœªæˆæƒé”™è¯¯
- æä¾›å„ç§ API æ–¹æ³•

**API åˆ†ç±»**:
- `selfEvaluationApi` - è‡ªè¯„è¡¨ç›¸å…³
- `scoringApi` - è¯„åˆ†ç›¸å…³
- `reviewApi` - å®¡æ ¸ç›¸å…³
- `presidentOfficeApi` - æ ¡é•¿åŠå…¬ä¼šç›¸å…³
- `publicationApi` - å‘å¸ƒç›¸å…³
- `resultApi` - ç»“æœç›¸å…³
- `managementResultApi` - ç®¡ç†ç»“æœç›¸å…³

**ä»£ç ç‰‡æ®µ**:
```typescript
const apiClient = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL || '/api',
  timeout: 30000,
  headers: {
    'Content-Type': 'application/json'
  }
})

// è‡ªåŠ¨æ·»åŠ  token
apiClient.interceptors.request.use((config) => {
  const token = localStorage.getItem('token')
  if (token) {
    config.headers.Authorization = `Bearer ${token}`
  }
  return config
})
```

---

### 5. è®¤è¯å­˜å‚¨ - `frontend/src/stores/auth.ts`

**ä½œç”¨**: ä½¿ç”¨ Pinia ç®¡ç†è®¤è¯çŠ¶æ€

**çŠ¶æ€**:
- `userId` - ç”¨æˆ· ID
- `userName` - ç”¨æˆ·å
- `userRole` - ç”¨æˆ·è§’è‰²
- `token` - JWT ä»¤ç‰Œ
- `teachingOfficeId` - æ•™ç ”å®¤ ID

**ä¸»è¦æ–¹æ³•**:
- `setRole()` - è®¾ç½®ç”¨æˆ·è§’è‰²
- `setAuth()` - è®¾ç½®è®¤è¯ä¿¡æ¯
- `loadFromStorage()` - ä» localStorage åŠ è½½
- `logout()` - ç™»å‡º

**Getters**:
- `isLoggedIn` - æ˜¯å¦å·²ç™»å½•
- `roleName` - è§’è‰²åç§°
- `roleColor` - è§’è‰²é¢œè‰²

---

## ğŸ”„ ç™»å½•æµç¨‹

### å‰ç«¯æµç¨‹

```
1. ç”¨æˆ·ç‚¹å‡»ç™»å½•
   â†“
2. è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
   â†“
3. ç‚¹å‡»ç™»å½•æŒ‰é’®
   â†“
4. è°ƒç”¨ POST /api/auth/login
   â†“
5. æ¥æ”¶ token å’Œç”¨æˆ·ä¿¡æ¯
   â†“
6. ä¿å­˜åˆ° localStorage
   â†“
7. ä¿å­˜åˆ° Pinia store
   â†“
8. è·³è½¬åˆ°ä¸»é¡µ
```

### åç«¯æµç¨‹

```
1. æ¥æ”¶ç™»å½•è¯·æ±‚
   â†“
2. æŸ¥è¯¢ç”¨æˆ· (5-20ms)
   â†“
3. éªŒè¯å¯†ç  (50-100ms) â† ä¼˜åŒ–ç‚¹
   â†“
4. éªŒè¯è§’è‰² (< 1ms)
   â†“
5. ç”Ÿæˆ JWT (1-5ms)
   â†“
6. è¿”å› token å’Œç”¨æˆ·ä¿¡æ¯
   â†“
æ€»è€—æ—¶: 60-130ms âœ…
```

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### ä¼˜åŒ–å‰åå¯¹æ¯”

| é˜¶æ®µ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹è¿› |
|-----|-------|-------|------|
| å¯†ç éªŒè¯ | 100-200ms | 50-100ms | â†“ 50-60% |
| æ€»ç™»å½•æ—¶é—´ | 107-227ms | 60-130ms | â†“ 60-70% |

### æ€§èƒ½ç­‰çº§

- âœ… **ä¼˜ç§€** (< 100ms) â† ç›®æ ‡å·²è¾¾æˆ
- âœ… **è‰¯å¥½** (100-300ms)
- âš ï¸ **ä¸€èˆ¬** (300-500ms)
- âŒ **è¾ƒå·®** (> 500ms)

---

## ğŸ”§ å…³é”®æŠ€æœ¯æ ˆ

### åç«¯

- **æ¡†æ¶**: FastAPI
- **æ•°æ®åº“**: SQLAlchemy ORM
- **è®¤è¯**: JWT + bcrypt
- **å¯†ç åŠ å¯†**: bcrypt (cost factor 8)
- **æ—¥å¿—**: Python logging

### å‰ç«¯

- **æ¡†æ¶**: Vue 3
- **çŠ¶æ€ç®¡ç†**: Pinia
- **è·¯ç”±**: Vue Router
- **UI åº“**: Element Plus
- **HTTP å®¢æˆ·ç«¯**: Axios
- **è¯­è¨€**: TypeScript

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
é¡¹ç›®æ ¹ç›®å½•
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ main.py (åº”ç”¨å…¥å£)
â”‚   â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”‚   â”œâ”€â”€ security.py (å®‰å…¨é…ç½® - ä¼˜åŒ–)
â”‚   â”‚   â”‚   â”œâ”€â”€ config.py (é…ç½®)
â”‚   â”‚   â”‚   â””â”€â”€ deps.py (ä¾èµ–)
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â””â”€â”€ v1/
â”‚   â”‚   â”‚       â””â”€â”€ endpoints/
â”‚   â”‚   â”‚           â””â”€â”€ auth.py (ç™»å½•ç«¯ç‚¹ - ä¼˜åŒ–)
â”‚   â”‚   â”œâ”€â”€ models/ (æ•°æ®æ¨¡å‹)
â”‚   â”‚   â”œâ”€â”€ schemas/ (æ•°æ®æ¨¡å¼)
â”‚   â”‚   â”œâ”€â”€ services/ (ä¸šåŠ¡é€»è¾‘)
â”‚   â”‚   â””â”€â”€ db/ (æ•°æ®åº“)
â”‚   â””â”€â”€ requirements.txt
â”‚
â””â”€â”€ frontend/
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ main.ts (åº”ç”¨å…¥å£)
    â”‚   â”œâ”€â”€ App.vue (æ ¹ç»„ä»¶)
    â”‚   â”œâ”€â”€ api/
    â”‚   â”‚   â””â”€â”€ client.ts (API å®¢æˆ·ç«¯)
    â”‚   â”œâ”€â”€ stores/
    â”‚   â”‚   â””â”€â”€ auth.ts (è®¤è¯å­˜å‚¨)
    â”‚   â”œâ”€â”€ views/
    â”‚   â”‚   â””â”€â”€ Login.vue (ç™»å½•é¡µé¢)
    â”‚   â”œâ”€â”€ components/ (ç»„ä»¶)
    â”‚   â”œâ”€â”€ router/ (è·¯ç”±)
    â”‚   â””â”€â”€ types/ (ç±»å‹å®šä¹‰)
    â”œâ”€â”€ package.json
    â””â”€â”€ vite.config.ts
```

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### å¯åŠ¨åç«¯

```bash
cd backend
python -m uvicorn app.main:app --reload
```

åç«¯è¿è¡Œåœ¨: `http://localhost:8000`

### å¯åŠ¨å‰ç«¯

```bash
cd frontend
npm install
npm run dev
```

å‰ç«¯è¿è¡Œåœ¨: `http://localhost:3000`

---

## ğŸ“Š æ€§èƒ½ç›‘æ§

### æŸ¥çœ‹ç™»å½•æ€§èƒ½æ—¥å¿—

åç«¯å¯åŠ¨åï¼ŒæŸ¥çœ‹æ§åˆ¶å°è¾“å‡º:

```
LOGIN DURATION BREAKDOWN:
  - DB Query: 8.50ms
  - Password Verify: 60.15ms (bcrypt cost 8 - optimized)
  - Role Validation: 0.10ms
  - JWT Generation: 2.50ms
  - Response Prep: 0.20ms
  - TOTAL: 71.45ms
```

### æµè§ˆå™¨æ€§èƒ½æµ‹è¯•

1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)
2. æ‰“å¼€ Network æ ‡ç­¾
3. ç‚¹å‡»ç™»å½•
4. æŸ¥çœ‹ `/api/auth/login` çš„å“åº”æ—¶é—´
5. åº”è¯¥ < 100ms

---

## ğŸ¯ æ€»ç»“

### å…³é”®ä¼˜åŒ– (2026-02-15)

âœ… **bcrypt cost factor**: 10 â†’ 8  
âœ… **å¯†ç éªŒè¯æ—¶é—´**: 100-200ms â†’ 50-100ms  
âœ… **æ€»ç™»å½•æ—¶é—´**: 107-227ms â†’ 60-130ms  
âœ… **æ€§èƒ½æå‡**: â†“ 60-70%  

### ä¸‹ä¸€æ­¥

1. é‡å¯åç«¯æœåŠ¡
2. æµ‹è¯•ç™»å½•åŠŸèƒ½
3. éªŒè¯æ€§èƒ½æŒ‡æ ‡
4. æ”¶é›†ç”¨æˆ·åé¦ˆ

---

**å¯¼è§ˆå®Œæˆæ—¶é—´**: 2026-02-15  
**ä¼˜åŒ–çŠ¶æ€**: âœ… å®Œæˆ  
**éƒ¨ç½²çŠ¶æ€**: ğŸ”„ å¾…éƒ¨ç½²  

