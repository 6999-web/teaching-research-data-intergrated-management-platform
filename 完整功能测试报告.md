# 教研室工作考评系统 - 完整功能测试报告

**测试日期**: 2026年2月15日  
**测试人员**: Kiro AI Assistant  
**项目**: 教研室工作考评系统  
**技术栈**: Python FastAPI + Vue 3 + PostgreSQL/MySQL

---

## 一、测试结果总览

### 教研室端（teaching_office）功能测试

| 功能 | 状态 | 备注 |
|------|------|------|
| 登录功能 | ⏳ 待测 | 使用 director1 / password123 |
| 考评表上传 | ⏳ 待测 | 验证 POST /api/teaching-office/self-evaluation |
| 附件上传 | ⏳ 待测 | 验证 POST /api/teaching-office/attachments |
| 表单提交 | ⏳ 待测 | 验证 POST /api/teaching-office/self-evaluation/{id}/submit |

### 考评小组端（evaluation_team）功能测试

| 功能 | 状态 | 备注 |
|------|------|------|
| 登录功能 | ⏳ 待测 | 使用 evaluator1 / password123 |
| 加载考评表 | ⏳ 待测 | 验证 GET /api/teaching-office/self-evaluation/{id} |
| 加载附件列表 | ⏳ 待测 | 验证 GET /api/teaching-office/attachments/{id} |
| 评分功能 | ⏳ 待测 | 验证 POST /api/scoring/manual-score |
| 提交评分 | ⏳ 待测 | 验证评分状态更新 |

---

## 二、详细测试步骤

### 第一阶段：教研室端测试

#### 1.1 登录测试
- [ ] 访问 http://localhost:3000
- [ ] 选择"教研室端"
- [ ] 输入用户名: director1
- [ ] 输入密码: password123
- [ ] 验证登录成功
- [ ] 检查 Token 是否正确保存

#### 1.2 考评表上传测试
- [ ] 点击"填写自评表"
- [ ] 填写表单内容
- [ ] 验证 API 请求: POST /api/teaching-office/self-evaluation
- [ ] 检查响应状态码: 201 Created
- [ ] 验证数据库中是否保存了记录
- [ ] 检查字段: teaching_office_id, evaluation_year, content, status

#### 1.3 附件上传测试
- [ ] 选择附件上传
- [ ] 上传测试文件 (PDF, DOC, DOCX, JPG, PNG)
- [ ] 验证 API 请求: POST /api/teaching-office/attachments
- [ ] 检查响应状态码: 201 Created
- [ ] 验证数据库中是否保存了附件记录
- [ ] 检查字段: file_name, file_path, evaluation_id, indicator

#### 1.4 表单提交测试
- [ ] 点击"提交"按钮
- [ ] 验证 API 请求: POST /api/teaching-office/self-evaluation/{id}/submit
- [ ] 检查响应状态码: 200 OK
- [ ] 验证数据库中状态是否更新为 "locked"
- [ ] 验证是否自动触发 AI 评分

### 第二阶段：考评小组端测试

#### 2.1 登录测试
- [ ] 访问 http://localhost:3000
- [ ] 选择"管理端"
- [ ] 选择角色: "评教小组"
- [ ] 输入用户名: evaluator1
- [ ] 输入密码: password123
- [ ] 验证登录成功

#### 2.2 加载考评表测试
- [ ] 进入"手动评分"页面
- [ ] 验证 API 请求: GET /api/teaching-office/self-evaluation/{id}
- [ ] 检查响应状态码: 200 OK
- [ ] 验证是否返回正确的考评表数据
- [ ] 检查是否存在 403 权限错误

#### 2.3 加载附件列表测试
- [ ] 在"手动评分"页面查看附件
- [ ] 验证 API 请求: GET /api/teaching-office/attachments/{id}
- [ ] 检查响应状态码: 200 OK
- [ ] 验证是否返回正确的附件列表
- [ ] 验证是否可以下载附件

#### 2.4 评分功能测试
- [ ] 填写评分表单
- [ ] 输入各项评分
- [ ] 验证 API 请求: POST /api/scoring/manual-score
- [ ] 检查响应状态码: 201 Created
- [ ] 验证数据库中是否保存了评分记录
- [ ] 检查字段: evaluator_id, evaluation_id, score, comment

#### 2.5 提交评分测试
- [ ] 点击"提交评分"按钮
- [ ] 验证 API 请求: PUT /api/scoring/manual-score/{id} 或类似
- [ ] 检查响应状态码: 200 OK
- [ ] 验证数据库中状态是否更新
- [ ] 验证是否防止重复提交

---

## 三、权限检查清单

### JWT 验证
- [ ] Token 是否正确解析
- [ ] Token 中的 role 是否正确
- [ ] Token 是否在请求头中正确传递

### 角色权限
- [ ] teaching_office 是否只能访问自己的数据
- [ ] evaluation_team 是否可以访问评分数据
- [ ] 是否存在 403 权限错误

### 数据隔离
- [ ] teaching_office 是否只能看到自己的考评表
- [ ] evaluation_team 是否可以看到所有考评表
- [ ] 是否存在数据泄露

---

## 四、文件上传检查清单

### 文件保存
- [ ] 文件是否正确保存到服务器
- [ ] 文件路径是否正确记录到数据库
- [ ] 是否支持所有指定格式 (PDF, DOC, DOCX, JPG, PNG)

### 文件访问
- [ ] 是否可以下载已上传的文件
- [ ] 文件访问是否需要权限验证
- [ ] 是否存在文件访问漏洞

### 数据库记录
- [ ] attachments 表是否正确记录
- [ ] 字段是否完整: id, file_name, file_path, evaluation_id, indicator
- [ ] 是否存在外键关联

---

## 五、数据库关联检查清单

### 表关系验证
- [ ] self_evaluations 与 teaching_offices 的关联
- [ ] attachments 与 self_evaluations 的关联
- [ ] manual_scores 与 self_evaluations 的关联
- [ ] manual_scores 与 users 的关联

### 数据完整性
- [ ] 是否存在孤立记录
- [ ] 外键约束是否正确
- [ ] 级联删除是否正确配置

---

## 六、前端 API 调用检查清单

### Authorization Header
- [ ] 是否正确携带 Token
- [ ] 格式是否为 "Bearer <token>"
- [ ] 是否在所有需要认证的请求中包含

### 请求/响应处理
- [ ] 是否正确处理 401 Unauthorized
- [ ] 是否正确处理 403 Forbidden
- [ ] 是否正确处理 404 Not Found
- [ ] 是否正确处理 500 Server Error

### 错误提示
- [ ] 是否向用户显示友好的错误信息
- [ ] 是否记录错误日志
- [ ] 是否提供重试机制

---

## 七、发现的问题

（待填充）

---

## 八、修复方案

（待填充）

---

## 九、修复后的验证

（待填充）

---

## 十、最终结论

（待填充）

---

**测试完成时间**: ___________  
**测试人员签名**: ___________  
**审核人员签名**: ___________
