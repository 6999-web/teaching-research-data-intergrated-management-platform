# 教研室工作考评系统 - 功能说明文档

**版本**: v2.1.0
**最后更新**: 2026-02-18
**状态**: ✅ 运行中

---

## 目录

1. [系统概述](#系统概述)
2. [角色与权限](#角色与权限)
3. [核心功能模块](#核心功能模块)
4. [业务流程](#业务流程)
5. [测试账号](#测试账号)
6. [技术架构](#技术架构)
7. [快速开始](#快速开始)

---

## 系统概述

### 系统简介

教研室工作考评系统是一个基于Web的数字化考评管理平台，实现教研室自评、AI自动评分、考评小组评审、考评办公室审定、结果公示与分发的全流程数字化管理。

### 系统特点

- 🎯 **多角色协作**: 教研室、考评小组、考评办公室、校长办公会四级角色
- 🤖 **AI智能评分**: 集成DeepSeek AI实现自动评分
- 📊 **数据可视化**: 丰富的图表展示与数据分析
- 📝 **改进闭环**: 结果反馈与持续改进跟踪
- 🔒 **权限管理**: 基于角色的访问控制（RBAC）
- 📱 **响应式设计**: 支持桌面端和移动端

---

## 角色与权限

### 角色架构

| 角色 | 英文标识 | 主要职责 |
|------|---------|---------|
| **教研室端** | teaching_office | 创建并提交自评表、上传附件、查看结果、提交改进措施 |
| **考评小组** | evaluation_team | 查看自评表、手动评分、提交到考评办公室 |
| **考评办公室** | evaluation_office | 最终评分、结果审核、提交到校长办公会 |
| **校长办公会** | president_office | 结果审定、发布公示 |

### 权限矩阵

| 功能模块 | 教研室 | 考评小组 | 考评办公室 | 校长办公会 |
|---------|:------:|:--------:|:----------:|:----------:|
| 创建自评表 | ✅ | ❌ | ❌ | ❌ |
| 上传附件 | ✅ | ❌ | ❌ | ❌ |
| 提交自评表 | ✅ | ❌ | ❌ | ❌ |
| AI评分 | - | ✅ | - | - |
| 手动评分 | ❌ | ✅ | ✅ | ❌ |
| 最终确定 | ❌ | ❌ | ✅ | ❌ |
| 结果审定 | ❌ | ❌ | ❌ | ✅ |
| 结果公示 | ❌ | ❌ | ❌ | ✅ |
| 改进措施 | ✅ | ❌ | ❌ | ❌ |
| 数据统计 | ❌ | ❌ | ✅ | ✅ |

---

## 核心功能模块

### 1. 教研室端功能

#### 1.1 填写自评表

- **功能描述**: 教研室填写年度工作考评表
- **支持操作**:
  - 📝 创建新考评表（每年可提交多次）
  - ✏️ 编辑草稿状态的考评表
  - 📋 支持多指标分类填写
  - 💾 自动保存草稿

#### 1.2 上传附件

- **功能描述**: 上传支撑材料作为评分依据
- **支持操作**:
  - 📤 拖拽或点击上传文件
  - 📂 支持多文件批量上传
  - 🏷️ 为每个附件选择对应考核指标
  - ❌ 删除已上传的附件
  - 📄 支持格式: PDF, DOC, DOCX, JPG, PNG
  - ⚙️ 单文件限制: 50MB
  - 📊 最多上传: 10个文件

#### 1.3 提交自评表

- **功能描述**: 将填写完成的自评表提交到考评小组
- **流程说明**:
  1. 填写考评表内容
  2. 上传相关附件（可选）
  3. 点击"提交"按钮
  4. 状态变更: `draft` → `submitted`

#### 1.4 结果查看

- **功能描述**: 查看本教研室的评分结果
- **展示内容**:
  - 各指标得分详情
  - AI评分与手动评分对比
  - 综合排名情况
  - 评审意见和建议

#### 1.5 改进措施

- **功能描述**: 针对评分结果提交下学期改进计划
- **支持操作**:
  - 📝 编写改进措施
  - 📊 关联具体考核指标
  - 📅 设置改进目标和时间节点
  - 📈 跟踪改进进度

---

### 2. 考评小组端功能

#### 2.1 待评分列表

- **功能描述**: 查看所有已提交等待评分的自评表
- **筛选功能**:
  - 按年度筛选
  - 按教研室筛选
  - 按状态筛选（已提交/AI已评分/手动评分中）

#### 2.2 手动评分

- **功能描述**: 考评小组成员对自评表进行人工评分
- **操作流程**:
  1. 查看教研室提交的自评表内容
  2. 下载/预览附件材料
  3. 根据评分标准逐项打分
  4. 填写评审意见
  5. 提交评分

#### 2.3 AI智能评分

- **功能描述**: 触发AI进行自动评分
- **技术特点**:
  - 基于DeepSeek大语言模型
  - 自动解析自评表内容和附件
  - 根据评分标准自动计算分数
  - 生成评分说明和建议

#### 2.4 提交到考评办公室

- **功能描述**: 完成评分后提交给考评办公室进行最终审定

---

### 3. 考评办公室功能

#### 3.1 评分审核

- **功能描述**: 审核考评小组的评分结果
- **支持操作**:
  - 查看AI评分和手动评分详情
  - 对比分析评分差异
  - 调整最终得分
  - 添加审核意见

#### 3.2 最终确定

- **功能描述**: 确定各教研室的最终得分和排名

#### 3.3 数据统计

- **功能描述**: 查看整体考评数据统计
- **统计图表**:
  - 📊 得分分布柱状图
  - 📈 排名趋势折线图
  - 🥧 指标得分雷达图
  - 📋 详细数据表格

---

### 4. 校长办公会功能

#### 4.1 结果审定

- **功能描述**: 校长办公会对考评结果进行最终审定
- **支持操作**:
  - 查看完整考评结果
  - 审阅排名情况
  - 批准或要求修改
  - 添加审定意见

#### 4.2 结果公示

- **功能描述**: 发布考评结果供全校查看
- **功能特点**:
  - 一键发布公示
  - 公示期设置
  - 异议处理功能

---

## 业务流程

### 完整工作流程图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           教研室工作考评系统流程                              │
└─────────────────────────────────────────────────────────────────────────────┘

    ┌──────────────┐
    │   教研室端    │
    │  (填写表)    │
    └──────┬───────┘
           │
           ▼
    ┌──────────────┐
    │   上传附件    │  ← 可选步骤
    └──────┬───────┘
           │
           ▼
    ┌──────────────┐     状态: draft → submitted
    │   提交自评    │────────────────────────────────┐
    └──────────────┘                                 │
                                                     ▼
    ┌──────────────────────────────────────────────────────────┐
    │                      考评小组端                           │
    │  ┌─────────────┐    ┌─────────────┐                     │
    │  │  AI智能评分  │ ←→ │  手动评分   │                     │
    │  │ (ai_scored) │    │(manually_   │                     │
    │  └─────────────┘    │  scored)    │                     │
    │                     └──────┬──────┘                     │
    │                            │                             │
    │                            ▼                             │
    │                     ┌─────────────┐                      │
    │                     │ 提交到办公室 │  状态: → ready_for_final
    │                     └──────┬──────┘                      │
    └────────────────────────────┼─────────────────────────────┘
                                 │
                                 ▼
    ┌──────────────────────────────────────────────────────────┐
    │                     考评办公室端                          │
    │                                                            │
    │                     ┌─────────────┐                       │
    │                     │  最终确定    │  状态: → finalized
    │                     └──────┬──────┘                       │
    │                            │                              │
    └────────────────────────────┼──────────────────────────────┘
                                 │
                                 ▼
    ┌──────────────────────────────────────────────────────────┐
    │                     校长办公会端                           │
    │                                                            │
    │                     ┌─────────────┐                       │
    │                     │  结果审定    │                       │
    │                     └──────┬──────┘                       │
    │                            │                              │
    │                            ▼                              │
    │                     ┌─────────────┐                       │
    │                     │  结果公示    │  状态: → published
    │                     └──────┬──────┘                       │
    └────────────────────────────┼──────────────────────────────┘
                                 │
                                 ▼
    ┌──────────────────────────────────────────────────────────┐
    │                       教研室端                            │
    │                                                            │
    │                     ┌─────────────┐                       │
    │                     │ 查看结果    │                        │
    │                     └──────┬──────┘                       │
    │                            │                              │
    │                            ▼                              │
    │                     ┌─────────────┐                       │
    │                     │ 改进措施    │  ← 形成改进闭环
    │                     └─────────────┘                       │
    └──────────────────────────────────────────────────────────┘
```

### 状态流转说明

| 状态值 | 说明 | 触发条件 |
|-------|------|---------|
| `draft` | 草稿 | 创建新自评表时 |
| `submitted` | 已提交 | 教研室点击提交 |
| `ai_scored` | AI已评分 | 触发AI评分完成 |
| `manually_scored` | 已手动评分 | 考评小组提交评分 |
| `ready_for_final` | 待最终确定 | 提交到考评办公室 |
| `finalized` | 已最终确定 | 考评办公室确定 |
| `published` | 已公示 | 校长办公会发布 |

---

## 测试账号

### 本地/测试环境账号

| 角色 | 用户名 | 密码 | 说明 |
|------|--------|------|------|
| 教研室 | director1 | password123 | 计算机科学教研室 |
| 教研室 | director2 | password123 | 数学教研室 |
| 教研室 | director3 | password123 | 物理教研室 |
| 考评小组 | evaluator1 | password123 | 评委张老师 |
| 考评小组 | evaluator2 | password123 | 评委李老师 |
| 考评办公室 | office1 | password123 | 办公室主任 |
| 校长办公会 | president1 | password123 | 校长 |

---

## 技术架构

### 前端技术栈

```
Vue 3 + TypeScript
├── Element Plus (UI组件库)
├── Vite (构建工具)
├── Vue Router (路由管理)
├── Pinia (状态管理)
├── Axios (HTTP客户端)
└── ECharts (数据可视化)
```

### 后端技术栈

```
FastAPI + Python
├── SQLAlchemy (ORM)
├── SQLite (数据库)
├── JWT (身份认证)
├── DeepSeek API (AI评分)
└── Uvicorn (ASGI服务器)
```

### 系统架构图

```
┌─────────────────────────────────────────────────────────────┐
│                      客户端层 (Browser)                       │
│                                                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐          │
│  │ 教研室端    │  │ 考评小组端  │  │ 管理端      │          │
│  │ Vue组件     │  │ Vue组件     │  │ Vue组件     │          │
│  └─────────────┘  └─────────────┘  └─────────────┘          │
└──────────────────────────┬──────────────────────────────────┘
                           │ HTTPS/WebSocket
                           ▼
┌─────────────────────────────────────────────────────────────┐
│                     后端服务层 (FastAPI)                      │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐   │
│  │                    API路由层                          │   │
│  │  /auth/*      认证授权                               │   │
│  │  /teaching-office/*  教研室端接口                     │   │
│  │  /scoring/*   评分接口                               │   │
│  │  /review/*    审核接口                               │   │
│  │  /publication/*  公示接口                            │   │
│  │  /improvement/*  改进措施接口                        │   │
│  └──────────────────────────────────────────────────────┘   │
│                            │                                 │
│                            ▼                                 │
│  ┌──────────────────────────────────────────────────────┐   │
│  │                   业务服务层                          │   │
│  │  认证服务 | 评分服务 | AI服务 | 通知服务              │   │
│  └──────────────────────────────────────────────────────┘   │
│                            │                                 │
│                            ▼                                 │
│  ┌──────────────────────────────────────────────────────┐   │
│  │                   数据访问层                          │   │
│  │            SQLAlchemy ORM                             │   │
│  └──────────────────────────────────────────────────────┘   │
└──────────────────────────┬──────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────┐
│                     数据存储层                               │
│                                                              │
│  ┌────────────┐                                             │
│  │   SQLite   │  关系型数据库                                │
│  └────────────┘                                             │
│                                                              │
│  ┌────────────┐                                             │
│  │  文件系统   │  附件存储                                   │
│  └────────────┘                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 快速开始

### 本地开发环境

#### 1. 启动前端

```bash
cd frontend
npm install
npm run dev
```

前端运行在: http://localhost:3000

#### 2. 启动后端

```bash
cd backend
python -m venv venv

# Windows
venv\Scripts\activate

# Linux/Mac
source venv/bin/activate

pip install -r requirements.txt
python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

后端运行在: http://localhost:8000

API文档: http://localhost:8000/docs

#### 3. 初始化测试数据

首次运行需要导入测试数据:

```bash
cd backend
python -c "from app.db.init_db import init_db; init_db()"
```

或者直接执行SQL初始化脚本。

### 访问系统

1. 打开浏览器访问 http://localhost:3000
2. 使用测试账号登录
3. 按照业务流程进行测试

---

## 常见问题

### Q1: 登录时提示"用户名或密码错误"

**A**: 请确认使用正确的测试账号。默认密码统一为 `password123`。

### Q2: 教研室无法创建新的考评表

**A**: 系统已支持每年多次提交，如果仍有问题请检查后端服务是否正常运行。

### Q3: 附件上传失败

**A**: 检查以下几点：
- 文件大小是否超过50MB
- 文件格式是否支持（PDF/DOC/DOCX/JPG/PNG）
- 文件数量是否超过10个
- 后端服务是否正常运行

### Q4: AI评分不工作

**A**: AI评分需要配置DeepSeek API Key，请检查后端`.env`配置文件。

---

## 更新日志

### v2.1.0 (2026-02-18)

**新增功能**
- ✅ 每年可多次提交考评表（不再限制每年一次）
- ✅ 移除考评表锁定功能，提交后状态为`submitted`

**Bug修复**
- 🐛 修复403权限错误问题
- 🐛 修复500服务器内部错误
- 🐛 修复附件404路径错误

### v2.0.0 (2026-02-15)

**重大更新**
- ✅ 前端重构，使用Vue 3 + TypeScript
- ✅ 后端使用FastAPI替代Flask
- ✅ 数据库迁移到SQLite
- ✅ 全新UI设计，警察蓝色配色主题
- ✅ 响应式布局优化

### v1.0.0 (2026-02-06)

**初始版本**
- ✅ 基础功能实现
- ✅ 四角色权限系统
- ✅ AI评分集成
- ✅ 数据可视化

---

## 相关文档

- [快速开始指南](QUICK_START.md)
- [部署指南](DEPLOYMENT_GUIDE.md)
- [系统架构文档](系统架构和文件导览-2026-02-15.md)
- [API路径配置说明](API路径和权限问题修复说明.md)

---

**文档维护**: 开发团队
**最后更新**: 2026-02-18
